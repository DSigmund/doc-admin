<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">

<section id="upgrading">
    <title>Upgrading OTRS from 5 to 6</title>

    <para>
    These instructions are for people upgrading OTRS from <emphasis>5</emphasis>
to <emphasis>6</emphasis> or from a <emphasis>5</emphasis> to a later
patchlevel release <emphasis>5</emphasis> and applies both for RPM and
source code (tarball) upgrades.
    </para>

    <para>
    If you are running a lower version of OTRS you have to follow the upgrade
path to 5 first
(1.1->1.2->1.3->2.0->2.1->2.2->2.3->2.4->3.0->3.1->3.2->3.3->4->5)! You need
to perform a full upgrade to every version in between, including database
changes and the upgrading Perl script.
    </para>

    <para>
    Vegye figyelembe, hogy ha a 2.2-es OTRS-ről vagy korábbiról frissít, akkor
<ulink url="http://bugs.otrs.org/show_bug.cgi?id=6798">egy további
lépést</ulink> is kell tennie.
    </para>

    <para>
    Within a single minor version you can skip patch level releases if you want
to upgrade. For instance you can upgrade directly from OTRS 6 patchlevel 2
to version 6 patchlevel 6. If you need to do such a "patch level upgrade",
you should skip steps 6 and XXXXX.
    </para>

    <warning>
        <para>
            Please note that you need at least Perl 5.16 to run OTRS 6. If your system
has an older Perl version, you need to update it first before updating OTRS.
        </para>
    </warning>

    <warning>
        <para>
            For PostgreSQL based installations: please note that you need at least
PostgreSQL 9.2 to run OTRS 6. If your system has an older PostgreSQL
version, you need to update it first before updating OTRS.
        </para>
    </warning>

    <para>
        Nagyon ajánlott először egy próbafrissítést végrehajtani egy elkülönített
tesztelési gépen.
    </para>

    <section role="NotInToc">
        <title>1. lépés: minden fontos szolgáltatás leállítása</title>

        <para>
        Győződjön meg arról, hogy nincs-e több olyan futó szolgáltatás vagy
cron-feladat, amely megpróbál hozzáférni az OTRS-hez. Ez a szolgáltatás
beállításától fog függeni. Itt egy példa:
        </para>

        <para>
            <screen><![CDATA[
shell> /etc/init.d/cron stop
shell> /etc/init.d/postfix stop
shell> /etc/init.d/apache stop
            ]]></screen>
        </para>

        <para>
        Stop OTRS cron jobs and the daemon (in this order):
        </para>

        <para>
            <screen><![CDATA[
shell> cd /opt/otrs/
shell> bin/Cron.sh stop
shell> bin/otrs.Daemon.pl stop
            ]]></screen>
        </para>
    </section>

    <section role="NotInToc">
        <title>Step 2: Backup files and database</title>

        <para>
            <itemizedlist>
                <listitem><para><filename>Kernel/Config.pm</filename></para></listitem>
                <listitem><para><filename>Kernel/Config/Files/ZZZAuto.pm</filename></para></listitem>
                <listitem><para><filename>var/*</filename></para></listitem>
                <listitem><para>valamint az adatbázis</para></listitem>
            </itemizedlist>
        </para>
        <warning>
            <para>Don't proceed without a complete backup of your system.</para>
        </warning>
    </section>

    <section role="NotInToc">
    <title>Step 3: Install the new release (tar or RPM)</title>

        <section role="NotInToc">
        <title>Step 3.1: With the tarball:</title>

            <screen><![CDATA[
shell> cd /opt
shell> mv otrs otrs-old
shell> tar -xzf otrs-x.x.x.tar.gz
shell> mv otrs-x.x.x otrs
            ]]></screen>

            <section role="NotInToc">
            <title>Régi beállítófájlok visszaállítása</title>

                <para>
                    <itemizedlist>
                        <listitem><para><filename>Kernel/Config.pm</filename></para></listitem>
                        <listitem><para><filename>Kernel/Config/Files/ZZZAuto.pm</filename></para></listitem>
                    </itemizedlist>
                </para>
            </section>

            <section role="NotInToc">
                <title>Bejegyzésadatok visszaállítása</title>

                <para>
                    Ha úgy állította be az OTRS-t, hogy a bejegyzésadatokat a fájlrendszeren
tárolja, akkor vissza kell állítania az <filename>article</filename> mappát
az <filename>/opt/otrs/var/</filename> mappába, vagy a
rendszerbeállításokban megadott mappába.
                </para>
            </section>


            <section role="NotInToc">
                <title>Restore already installed default statistics</title>

                <para>
                    If you have additional packages with default statistics you have to restore
the stats xml files with the suffix <filename>*.installed</filename> to
<filename>/opt/otrs/var/stats</filename>.
                </para>
                <screen><![CDATA[
shell> cd OTRS-BACKUP/var/stats
shell> cp *.installed /opt/otrs/var/stats
                ]]></screen>
            </section>

            <section role="NotInToc">
                <title>Fájljogosultságok beállítása</title>

                <para>
                    Please execute the following command as root user to set the file and
directory permissions for OTRS:
                </para>

                <para>
                <screen><![CDATA[
shell> cd /opt/otrs/
shell> bin/otrs.SetPermissions.pl
                ]]></screen>
                </para>

                <para>
                    It will try to detect the correct user and group settings needed for your
setup.
                </para>
            </section>
        </section>

        <section role="NotInToc">
            <title>Step 3.2: With the RPM:</title>
            <para>
            <screen><![CDATA[
shell> rpm -Uvh otrs-x.x.x.-01.rpm
            ]]></screen>
            </para>

            <para>
            Ebben az esetben az RPM frissítés automatikusan visszaállítja a régi
beállítófájlokat és beállítja a fájljogosultságokat.
            </para>
        </section>
    </section>

    <section role="NotInToc">
        <title>Step 4: Run the migration script</title>

        <para>
            Please run the migration script (as the <literal>otrs</literal> user, NOT as
<literal>root</literal>):
        </para>

        <para>
        <screen><![CDATA[
shell> scripts/DBUpdate-to-6.pl
        ]]></screen>
        </para>

        <para>
            This script will perform many checks on your system and give you advice on
how to install missing Perl modules etc., if that is required.
        </para>

        <para>
            The migration script will ask you to set a time zone for OTRS. It is very
important that you set the correct time zone (and keep it), otherwise date
and time of data added after the upgrade (tickets, articles, etc.) will be
stored with a different time zone than your existing data, leading to
inconsistent data.  The script will suggest possible time zones based on
your previous configuration. In case you are not sure or made a mistake, you
can change the OTRS time zone after the upgrade via SysConfig setting
<literal>OTRSTimeZone</literal>.
        </para>

        <warning>
            <para>
                Ne folytassa a frissítési folyamatot, ha ez a parancsfájl nem működött
megfelelően önnél. Egyébként adatvesztés fordulhat elő.
            </para>
        </warning>
    </section>

    <section role="NotInToc">
        <title>Step 5: Restart your services</title>

        <para>
        Például (a használt szolgáltatásoktól függően):
        </para>

        <para>
        <screen><![CDATA[
shell> /etc/init.d/apache start
shell> /etc/init.d/postfix start
shell> /etc/init.d/cron start
        ]]></screen>
        </para>

        <para>
        Most már bejelentkezhet a rendszerre.
        </para>
    </section>

    <section role="NotInToc">
        <title>Step 6: Check installed packages</title>
        <note>
            <para>
                The OTRS 5 packages are NOT compatible with OTRS 6, so you have to perform a
package upgrade!
            </para>
        </note>
        <para>
            A következő csomagok automatikusan el lesznek távolítva a frissítési
folyamat után (ha korábban telepítve voltak):
        </para>
        <para>
            <itemizedlist>
                <listitem><para>OTRSAppointmentCalendar</para></listitem>
            </itemizedlist>

        <!--
                TODO: Verify and extend the list of merged packages.
            -->
</para>
    </section>

    <section role="NotInToc">
        <title>Step 7: Start the OTRS Daemon</title>

        <para>
            The OTRS daemon is responsible for handling any asynchronous and recurring
tasks in OTRS.  The daemon also handles all GenericAgent jobs and must be
started as the <literal>otrs</literal> user.
        </para>

        <para>
            <screen><![CDATA[
shell> /opt/otrs/bin/otrs.Daemon.pl start
            ]]></screen>
        </para>
    </section>

    <section role="NotInToc">
        <title>Step 8: Update and activate cron jobs</title>

        <para>
            Két alapértelmezett OTRS cron-file van az
<filename>/opt/otrs/var/cron/*.dist</filename> fájlban, és a céljuk annak
ellenőrzése, hogy az OTRS démon fut-e. Be kell kapcsolni ezeket a „.dist”
fájlnévkiterjesztés nélkül történő lemásolásukkal.
        </para>

        <para>
            <screen><![CDATA[
shell> cd /opt/otrs/var/cron
shell> for foo in *.dist; do cp $foo `basename $foo .dist`; done
            ]]></screen>
        </para>

        <para>
            To schedule these cron jobs on your system, you can use the script
<filename>Cron.sh</filename> as the <literal>otrs</literal> user.
        </para>

        <para>
            <screen><![CDATA[
shell> /opt/otrs/bin/Cron.sh start
            ]]></screen>
        </para>
    </section>

    <section role="NotInToc">
        <title>Step 9: Update system registration (optional)</title>
        <para>
            Ha a rendszer már regisztrálva van az OTRS csoporttal, akkor most erősen
ajánlott a regisztrációs információk frissítése. Ez frissíteni fogja a
rendszer regisztrált verzióját (többek között a változtatásokat) az OTRS
csoport feljegyzéseiben annak érdekében, hogy még pontosabb információkat
kapjon a felhőszolgáltatásról.
        </para>
        <para>
            Ha nem frissíti kézzel a regisztrációs információkat, akkor az automatikusan
el lesz végezve rendszeresen, de ez csak néhány óra vagy nap múlva történik
meg. Ezen időszak alatt lehetséges lehet, hogy rossz információkat kap az
olyan felhőszolgáltatásoktól, mint például az <emphasis role="bold">OTRS
Business Solution™</emphasis> frissítések.
        </para>
        <para>
            <screen><![CDATA[
shell> cd /opt/otrs/
shell> bin/otrs.Console.pl Maint::Registration::UpdateSend --force
shell> bin/otrs.Console.pl Maint::Cache::Delete
            ]]></screen>
        </para>
    </section>

    <section role="NotInToc">
        <title>Step 10: Well done!</title>
        <para></para>
    </section>
</section>
