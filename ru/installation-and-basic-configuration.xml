<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">


<!-- $Id: installation-and-basic-configuration.xml,v 1.12 2011-05-31 13:03:50 mg Exp $ -->
<chapter id="installation">
<title>Установка</title>

<abstract>
<para>
В этой главе описывается установка и базовая конфигурация главного
OTRS-фреймворка. Здесь вы найдете информацию об установке OTRS из исходных
кодов или из бинарных пакетов, например RPM, или с помощью
Windows-инсталлятора.
</para>

<para>
В этой главе рассматриваются такие вопросы как: конфигурация веб-сервера и
сервера базы данных, интефейса между OTRS и базой данных, установка
дополнительных Perl-модулей, установка соответствующих прав доступа для
OTRS, настройка планировщика задач cron jobs для OTRS и основных параметров
в конфигурационных файлах.
</para>

<para>
Следуйте подробным шагам этой главы чтобы установить OTRS на своем
сервере. Потом можно использовать его веб-интерфейс чтобы войти в систему и
производить администрирование.
</para>
</abstract>

<section id="installation-of-prepared-packages">
<title>Самый простой способ - установка из готовых бинарных пакетов</title>

<para>
Самый простой и удобный способ установки OTRS - использовать готовые
(встроенные) пакеты, которые можно найти и загрузить перейдя по ссылке
<ulink url="http://www.otrs.org"> <citetitle>http://www.otrs.org</citetitle>
</ulink>. В следующих разделах описывается установка OTRS из готовых
(встроенных) или бинарных пакетов, специально собраных для операционных
систем: SUSE, Debian и Microsoft Windows. В случае если нету возможности
использовать готовые (встроенные) пакеты - установку придется производить
вручную.
</para>

<section id="installation-on-suse">
<title>Установка из rpm-пакетов на сервер под управлением Suse Linux</title>

<para>
В этом разделе описывается установка встроенных RPM пакетов на дистрибутив
SUSE Linux. Мы протестировали все SLES и OpenSUSE релизы, доступные на
данный момент. Перед началом установки перейдите по адресу <ulink
url="http://www.otrs.org/downloads">
<citetitle>http://www.otrs.org/downloads</citetitle> </ulink> и убедитесь
нету ли новых OTRS RPM пакетов, доступных для скачивания. Всегда старайтесь
использовать только самые новые RPM пакеты.
</para>

<para>
Для установки OTRS используйте конфигурационную утилиту
<application>yast</application> (yast2), командную строку
и<command>rpm</command>. Так как для работы OTRS необходимы Perl-модули,
которые по умолчанию не устанавливаются в системе SUSE, мы всегда
рекомендуем использовать менеджер пакетов <application>yast</application>,
поскольку он позволяет автоматически разрешать конфлиткы и зависимости между
пакетами.
</para>

<para>
Если вы решили устанавливать OTRS из командной строки используя
<application>rpm</application>, первое, что нужно сделать - это вручную
установить все необходимые Perl-модули. Предположим, что вы загрузили файл
<filename>otrs.rpm</filename> в директорию <filename>/tmp</filename>. Чтобы
начать установку OTRS необходимо выполнить команду, из Сценария 3.1.
</para>

<para>
Примечание: Если вы проводите установку на SLES9 (SUSE Linux Enterprise
Server By Novell) или OES (Open Enterprise Server), прочтите пожалуйста
инструкции, находящиеся по адресу
http://faq.otrs.org/otrs/public.pl?FAQID=49 , они помогут в установке
отсутсвтующих perl-GD пакетов.
</para>

<para>
<screen>
linux:~ # rpm -i /tmp/otrs-xxx.rpm
otrs                        ##################################################
Check OTRS user (/etc/passwd)... otrs exists.

Next steps:

[SuSEconfig]
 Execute 'SuSEconfig' to configure the web server.

[start Apache and MySQL]
 Execute 'rcapache restart' and 'rcmysql start' in case they don't run.

[install the OTRS database]
 Use a web browser and open this link:
 http://localhost/otrs/installer.pl

[OTRS services]
 Start OTRS 'rcotrs start-force' (rcotrs {start|stop|status|restart|start-force|stop-force}).

Have fun!

 Your OTRS Team
 http://otrs.org/

linux:~ #
</screen>
</para>

<para>
<emphasis>Сценарий 3.1. Команда для установки OTRS.</emphasis>
</para>

<para>
После установки RPM-пакета OTRS, нужно запустить
<application>SuSEconfig</application> так, как это показано в Сценарии 3.2.
</para>

<para>
<screen>
linux:~ # SuSEconfig
Starting SuSEconfig, the SuSE Configuration Tool...
Running in full featured mode.
Reading /etc/sysconfig and updating the system...
Executing /sbin/conf.d/SuSEconfig.aaa_at_first...
Executing /sbin/conf.d/SuSEconfig.apache...
Including /opt/otrs/scripts/apache-httpd.include.conf
Executing /sbin/conf.d/SuSEconfig.bootsplash...
Executing /sbin/conf.d/SuSEconfig.doublecheck...
Executing /sbin/conf.d/SuSEconfig.guile...
Executing /sbin/conf.d/SuSEconfig.hostname...
Executing /sbin/conf.d/SuSEconfig.ispell...
Executing /sbin/conf.d/SuSEconfig.perl...
Executing /sbin/conf.d/SuSEconfig.permissions...
Executing /sbin/conf.d/SuSEconfig.postfix...
Setting up postfix local as MDA...
Setting SPAM protection to "off"...
Executing /sbin/conf.d/SuSEconfig.profiles...
Finished.
linux:~ #
</screen>
</para>

<para>
<emphasis>Сценарий 3.2. Запуск команды SuSEconfig.</emphasis>
</para>

<para>
Установка OTRS завершена. Чтобы новые изменения, касающиеся конфигурации
OTRS, вступили в силу - перезагрузите веб-сервер используя команду из
Сценария 3.3.
</para>

<para>
<screen>
linux:~ # rcapache restart
Shutting down httpd                                         done
Starting httpd [ PERL ]                                     done
linux:~ #
</screen>
</para>

<para>
<emphasis>Сценарий 3.3. Перезапуск веб-сервера.</emphasis>
</para>

<para>
Следующим шагом является установка базы данных OTRS, как это сделать,
читайте здесь <link linkend="database-configuration">раздел 3.2.4.</link>
</para>

</section>

<section id="installation-on-centos">
<title>Установка OTRS в операционной системе CentOS</title>

<para>
Подробные инструкции по установке OTRS в операционной системе CentOS можно
найти на сайте OTRS Wiki по адресу <ulink
url="http://wiki.otrs.org/index.php?title=Installation_of_OTRS_3.0b1_on_CentOS_5.5">
http://wiki.otrs.org/index.php?title=Installation_of_OTRS_3.0b1_on_CentOS_5.5
</ulink>. Обратите внимание, что эти рекомендации также применимы и к другим
системам, в часности к RedHat.
</para>

</section>

<section id="installation-on-debian">
<title>Установка OTRS в операционной системе Debian</title>

<para>
Подробную информацию по установке OTRS в операционной системе Debian можно
найти на сайте OTRS Wiki по адресу <ulink
url="http://wiki.otrs.org/index.php?title=Installation_on_Debian_5.04_lenny">
http://wiki.otrs.org/index.php?title=Installation_on_Debian_5.04_lenny
</ulink> .
</para>

</section>

<section id="installation-on-ubuntu">
<title>Установка OTRS на системе Ubuntu</title>

<para>
Подробную информацию по установке OTRS в операционной системе Ubuntu можно
найти на сайте OTRS Wiki по адресу <ulink
url="http://wiki.otrs.org/index.php?title=Installation_on_Ubuntu_Lucid_Lynx_(10.4)">
http://wiki.otrs.org/index.php?title=Installation_on_Ubuntu_Lucid_Lynx_(10.4)
</ulink> ..
</para>

</section>

<section id="installation-on-windows">
<title>Установка OTRS на операционной системе Microsoft Windows</title>

<para>
Устанавливать OTRS в операционной системе Microsoft Windows очень легко и
просто. Перейдя по ссылке <ulink url="http://www.otrs.org/downloads/">
<citetitle>http://www.otrs.org/downloads/</citetitle> </ulink> загрузите
последнюю версию установщика для Win32-платформы и сохраните файл на жестком
диске компьютера. Затем просто запустите установочный файл и выполните все
шаги, предложеные мастером установки. После этого можно войти в OTRS с
правами администратора и сконфигурировать систему под свои
требования. Используйте логин root@localhost и пароль root, чтобы войти в
систему с правами администратора. (Примечание: логин root@localhost и пароль
root прописаны в системе по умолчанию).
</para>

<warning>
<para>
Постарайтесь как можно быстрее изменить пароль для аккаунта
'root@localhost'.
</para>
</warning>

<important>
<para>
Win32-инсталлятор содержит все компоненты, необходимые для работы OTRS:
веб-сервер <application>Apache</application>, сервер баз данных
<application>MySQL</application>, <application>Perl</application> (со всеми
необходимыми модулями), а также планировщик задач для
Windows<application>Cron</application>. Именно по этой причине, OTRS
необходимо устанавливать на Windows-системах, которые еще не содержат
установленого веб-сервера <application>Apache</application> или другого, а
также сервера баз данных <application>MySQL</application>.
</para>
</important>

</section>

</section>

<section id="manual-installation-of-otrs">
<title>Установка из исходных кодов (Linux, Unix)</title>

<section id="preparing-manual-installation">
<title>Подготовка к установке из исходных кодов</title>

<para>
Если вы решили устанавливать OTRS из исходных кодов, перейдите по ссылке
<ulink url="http://www.otrs.org/downloads/">
<citetitle>http://www.otrs.org/downloads/</citetitle> </ulink> и загрузите
архив с исходными кодами в любом удобном для вас формате: .tar.gz, .tar.bz2,
или .zip
</para>

<para>
Распакуйте архив (например с помощью команды <command>tar</command>) в
каталог <filename>/opt</filename> а затем переименуйте каталог otrs-3.0 на
otrs (см. ниже Сценарий 3.4).
</para>

<para>
<screen>
linux:/opt# tar xf /tmp/otrs-3.0.tar.gz
linux:/opt# mv otrs-3.0 otrs
linux:/opt# ls
otrs
linux:/opt#
</screen>
</para>

<para>
<emphasis>Script 3.4. Установка OTRS, первые шаги.</emphasis>
</para>

<para>
OTRS не должен выполнятся с правами администратора (root rights). На
следующем шаге установки для OTRS необходимо добавить нового
пользователя. Домашняя директория нового пользователя должна находится в
каталоге <filename>/opt/otrs</filename>.  Если веб-сервер не работает с теми
правами что и новый пользователь 'otrs' (а именно так и есть в большинстве
систем), то его нужно добавить в группу пользователей веб-сервера  (см ниже
Сценарий 3.5 ).
</para>

<para>
<screen>
linux:/opt# useradd -r -d /opt/otrs/ -c 'OTRS user' otrs
linux:/opt# usermod -G nogroup otrs
linux:/opt#
</screen>
</para>

<para>
<emphasis>Сценарий 3.5. Добавление нового пользователя 'otrs' и добавление
его в группу.</emphasis>
</para>

<para>
Затем нужно скопировать некоторые конфигурационные файлы (точнее
демонстрационные копии конфигурационных файлов), которые позже будут
использоваться системой. Файлы находятся в каталоге
<filename>/opt/otrs/Kernel</filename> и
<filename>/opt/otrs/Kernel/Config</filename> и имеют расширение (суффикс)
.dist (см. ниже Сценарий 3.6).
</para>

<para>
<screen>
linux:/opt# cd otrs/Kernel/
linux:/opt/otrs/Kernel# cp Config.pm.dist Config.pm
linux:/opt/otrs/Kernel# cd Config
linux:/opt/otrs/Kernel/Config# cp GenericAgent.pm.dist GenericAgent.pm
</screen>
</para>

<para>
<emphasis>Сценарий 3.6. Копирование демонстрационных копий конфигурационных
файлов</emphasis>
</para>

<para>
На завершающем этапе установки OTRS необходимо установить соответствующие
права доступа к файлам. Для этого используйте сценарий
<command>otrs.SetPermissions.pl</command>, находящийся в директории
<filename>bin</filename> домашнего каталога пользователя 'otrs'. Скрипт
можно вызвать со следующими параметрами:
</para>

<para>
<cmdsynopsis>
<command>otrs.SetPermissions.pl</command> <arg choice='req'>
<replaceable>Home directory of the OTRS user</replaceable> </arg> <arg
choice='req'> --otrs-user= <replaceable>OTRS user</replaceable> </arg> <arg
choice='req'> --web-user= <replaceable>Web server user</replaceable> </arg>
<arg choice='opt'> --otrs-group= <replaceable>Group of the OTRS
user</replaceable> </arg> <arg choice='opt'> --web-group= <replaceable>Group
of the web server user</replaceable> </arg></cmdsynopsis>
</para>

<para>
Если ваш веб-сервер работает с теми же правами что и пользователь 'otrs', то
команда установки надлежащих прав доступа будет выглядеть так:
<command>otrs.SetPermissions.pl /opt/otrs --otrs-user=otrs
--web-user=otrs</command>. На SUSE-системах веб-сервер работает с правами
пользователя 'wwwrun'. На Debian-системах - 'www-data'. Для установки
надлежащих прав доступа используйте команду <command>otrs.SetPermissions.pl
/opt/otrs --otrs-user=otrs --web-user=wwwrun --otrs-group=nogroup
--web-group=www</command>.
</para>

</section>

<section id="installation-of-perl-modules">
<title>Установка Perl-модулей</title>

<para>
Исходя из Таблицы 3-1. для работы OTRS необходимо установить некоторые
дополнительные модули Perl­. При установке OTRS из исходных кодов, эти
модули придется установить вручную. Конечно же это намного проще сделать
используя менеджер пакетов, который прилагается к вашему Linux-дистрибутиву
(<application>yast</application>, <application>apt-get</application>) или,
как описано в этом разделе, использовать оболочку Perl shell и CPAN. Если вы
используете ActiveState Perl, например, на Windows, то можно использовать
PPM, встроенный менеджер пакетов Perl (Perl Package Manager). Мы рекомендуем
использовать менеджер пакетов, если это возможно.
</para>

<para>

<table id="table-of-needed-perl-modules">
<title>Perl-модули, необходимые для работы OTRS</title>
  <tgroup cols="2">
    <thead>
      <row>
        <entry>
          Название
        </entry>
        <entry>
          Описание
        </entry>
      </row>
    </thead>
    <tbody>
      <row>
        <entry>
          DBI
        </entry>
        <entry>
          Устанавливает подключение к базе данных приложения.
        </entry>
      </row>
      <row>
        <entry>
          DBD::mysql
        </entry>
        <entry>
          Содержит специальные функции для подключения к серверу базы данных  MySQL
(только в случае, использования сервера базы данных MySQL)
        </entry>
      </row>
      <row>
        <entry>
          DBD::pg
        </entry>
        <entry>
          Содержит специальные функции для подключение к серверу базы данных
PostgreSQL (требуется только в случае использования PostgreSQL в качестве
сервера базы данных).
        </entry>
      </row>
      <row>
        <entry>
          Digest::MD5
        </entry>
        <entry>
          Позволяет использовать алгоритм MD5.
        </entry>
      </row>
      <row>
        <entry>
          CSS::Minifier
        </entry>
        <entry>
          Уменьшение размера CSS-файла и запись выходного потока напрямую в другой
файл.
        </entry>
      </row>
      <row>
        <entry>
          Crypt::PasswdMD5
        </entry>
        <entry>
          Обеспечение криптографических возможностей на основе алгоритма хеширования
MD5
        </entry>
      </row>
      <row>
        <entry>
          MIME::Base64
        </entry>
        <entry>
          Кодирование / декодирование Base64-кодированных строк, например для вложений
электронной почты.
        </entry>
      </row>
      <row>
        <entry>
          JavaScript:Minifier
        </entry>
        <entry>
          Уменьшение размера JavaScript-файла и запись выходного потока напрямую в
другой файл.
        </entry>
      </row>
      <row>
        <entry>
          Net::DNS
        </entry>
        <entry>
          Perl-интерфейс для DNS (Domain Name System - системы доменных имен).
        </entry>
      </row>
      <row>
        <entry>
          LWP::UserAgent
        </entry>
        <entry>
          Обработка HTTP-запросов.
        </entry>
      </row>
      <row>
        <entry>
          Net::LDAP
        </entry>
        <entry>
          Perl-интерфейс к LDAP-каталогу (только в случае использования LDAP в
качестве хранилища данных).
        </entry>
      </row>
      <row>
        <entry>
          GD
        </entry>
        <entry>
          Интерфейс к графической библиотеке GD  (требуется только в том случае, если
установлен модуль статистики OTRS).
        </entry>
      </row>
      <row>
        <entry>
          GD::Text, GD::Graph, GD::Graph::lines, GD::Text::Align
        </entry>
        <entry>
          Еще более широкий набор текстовых и графических инструментов для графической
библиотеки GD (требуется только в том случае, если установлен модуль
статистики OTRS).
        </entry>
      </row>
      <row>
        <entry>
          PDF::API2, Compress::Zlib
        </entry>
        <entry>
          Эти модули необходимы для генерации отчетов, результатов поиска, информации
о заявке в формате PDF.
        </entry>
      </row>
    </tbody>
  </tgroup>
</table>

</para>

<para>
Используйте команду <command>otrs.CheckModules.pl</command>, чтобы
проверить, какие модули необходимо установить. Этот сценарий находится в
директории <filename>bin</filename> домашнего каталогоа пользователя 'otrs'
(см. ниже Сценарий 3.7).
</para>

<para>
Пожалуйста, обратите внимание на то, что некоторые модули не являются
обязательными.
</para>

<para>
<screen>
linux:~# cd /opt/otrs/bin/
linux:/opt/otrs/bin# ./otrs.CheckModules.pl
   o CGI............................ok (v3.49)
   o Crypt::PasswdMD5...............ok (v1.3)
   o CSS::Minifier..................ok (v0.01)
   o Date::Format...................ok (v2.24)
   o Date::Pcalc....................ok (v1.2)
   o DBI............................ok (v1.609)
   o DBD::mysql.....................ok (v4.013)
   o Digest::MD5....................ok (v2.36_01)
   o Encode::HanExtra...............ok (v0.23)
   o GD.............................ok (v2.44)
      o GD::Text....................ok (v0.86)
      o GD::Graph...................ok (v1.44)
      o GD::Graph::lines............ok (v1.15)
      o GD::Text::Align.............ok (v1.18)
   o IO::Scalar.....................ok (v2.110)
   o IO::Wrap.......................ok (v2.110)
   o JavaScript::Minifier...........ok (v1.05)
   o JSON...........................ok (v2.21)
      o JSON::PP....................ok (v2.27003)
      o JSON::XS....................Not installed! (Optional - Install it for faster AJAX/JavaScript handling.)
   o LWP::UserAgent.................ok (v5.829)
   o Mail::Internet.................ok (v2.06)
   o Mail::POP3Client...............ok (v2.18 )
      o IO::Socket::SSL.............ok (v1.31)
   o MIME::Base64...................ok (v3.07_01)
   o MIME::Tools....................ok (v5.428)
   o Net::DNS.......................ok (v0.65)
   o Net::POP3......................ok (v2.29)
   o Net::IMAP::Simple..............ok (v1.1916)
      o Net::IMAP::Simple::SSL......ok (v1.3)
   o Net::SMTP......................ok (v2.31)
      o Authen::SASL................ok (v2.15)
      o Net::SMTP::SSL..............ok (v1.01)
   o Net::LDAP......................ok (v0.4001)
   o PDF::API2......................ok (v0.73)
      o Compress::Zlib..............ok (v2.008)
   o SOAP::Lite.....................ok (v0.712)
   o Text::CSV......................ok (v1.18)
      o Text::CSV_PP................ok (v1.26)
      o Text::CSV_XS................Not installed! (Optional - Optional, install it for faster CSV handling.)
   o XML::Parser....................ok (v2.36)
linux:/opt/otrs/bin#
</screen>
</para>

<para>
<emphasis>Сценарий 3.7. Проверка необходимых модулей.</emphasis>
</para>

<para>
Для установки недостающих модулей старайтесь использовать менеджер
управления пакетами, входящий в дистрибутив Linux. Таким образом, в случае
выхода обновлений или новых решений по обеспечению большей безопасности,
пакеты будут обновлятся автоматически. Чтобы узнать как установить
дополнительные пакеты обратитесь к документации, которая поставляется вместе
с дистрибутивом вашей операционной системы. Если модуль (соответствующая
версия) не доступен из репозитория пакетов, его всегда можно установить
используя CPAN, Comprehensive Perl Archive Network (всеобъемлющую сеть
архивов Perl).
</para>

<para>
Для установки любого из выше описанных модулей через CPAN, нужно выполнить
команду <command>perl -e shell -MCPAN</command>. Оболочка Perl запустится в
интерактивном режиме и модуль CPAN будет загружен. Если CPAN уже
сконфигурирован, то с помощью команды <command>install</command> "имя
модуля" (install module_name)  можно начинать установку необходимых
модулей. CPAN автоматически отслеживает зависимости между Perl-модулями и
тут же оповещает, какие еще модули нужно установить.
</para>

<para>
Также, после изменений в директории <filename>/opt/otrs</filename> выполните
эти две команды <command>perl -cw bin/cgi-bin/index.pl</command> и
<command>perl -cw bin/otrs.PostMaster.pl</command>. Если результатом
выполнения обеих команд будет "syntax OK", значит Perl установлен правильно
(см. ниже Сценарий 3.8).
</para>

<para>
<screen>
linux:~# cd /opt/otrs
linux:/opt/otrs# perl -cw bin/cgi-bin/index.pl
cgi-bin/installer.pl syntax OK
linux:/opt/otrs# perl -cw bin/otrs.PostMaster.pl
otrs.PostMaster.pl syntax OK
linux:/opt/otrs#
</screen>
</para>

<para>
<emphasis>Сценарий 3.8. Проверка синтаксиса.</emphasis>
</para>

</section>

<section id="web-server-configuration">
<title>Настройка веб-сервера Apache</title>

<para>
В этом разделе описывается базовая конфигурация веб-сервера
<application>Apache</application> с модулем mod_cgi, необходимым для работы
OTRS. Веб-сервер должен поддерживать выполнение CGI-сценариев. OTRS не будет
работать если нету возможности выполнять Perl-сценарии. Поэтому проверьте
настройки в конфигурационных файлах веб-сервера и убедитесть в том, что
строка, отвечающая за загрузку CGI-модуля не закоментирована. Если вы видите
что-то вроде следующего, значит CGI-модуль уже загружен и используется.
</para>

<para>
LoadModule cgi_module /usr/lib/apache2/modules/mod_cgi.so
</para>

<para>
Для простого и удобного доступа к веб-интерфейсу OTRS через короткий адрес,
нужно использовать Alias и ScriptAlias. Большинство установок
<application>Apache</application> имеют директорию
<filename>conf.d</filename>. Очень часто в Linux-системах эта директория
находится в <filename>/etc/apache</filename> или
<filename>/etc/apache2</filename>. Войдите в систему с правами
администратора (под root-ом), затем перейдите в диреторию
<filename>conf.d</filename> и скопируйте соответствующий шаблон
конфигурационного файла
<filename>/opt/otrs/scripts/apache2-httpd.include.conf</filename> в файл
<filename>otrs.conf</filename>, который находится в каталоге настроек
Apache.
</para>

<para>
Перезагрузите веб-сервер, чтобы новые настройки вступили в силу. На
большинстве систем запустить/перезагрузить веб-сервер можно с помощью
команды <command>/etc/init.d/apache2 restart</command> (см. ниже Сценарий
3.11 ).
</para>

<para>
<screen>
linux:/etc/apache2/conf.d# /etc/init.d/apache2 restart
Forcing reload of web server: Apache2.
linux:/etc/apache2/conf.d#
</screen>
</para>

<para>
<emphasis>Сценарий 3.11. Перезапуск веб-сервера. </emphasis>
</para>

<para>
Теперь веб-сервер полностью настроен для работы OTRS.
</para>

<para>
Для увеличения производительности можно установить mod_perl, отключить и не
использовать модуль mod_cgi, а затем, сконфигурировать веб-сервер
<application>Apache</application> на использование модуля mod_perl следующим
образом:
</para>

<para>
Чтобы воспользоваться этой функцией убедитесь в том, что модуль mod_perl
установлен и загружен. В связи с структурой сценария запуска, сервер не
удастся запустить если модуль mod_perl загружен/скомпилирован неправильно
или если он дальше продолжает работать. С технической точки зрения, вы все
же можете оставить модуль mod_cgi работать, но делать это не нужно.
</para>

<para>
Чтобы проверить загружен ли этот модуль, поищите файл mod_perl.so в каталоге
/etc/apache* (см. ниже Сценарий 3.12).
</para>

<para>
<screen> #:/ grep -Rn mod_perl.so /etc/apache*</screen>
</para>

<para>
<emphasis>Сценарий 3.12. Поиск mod_perl.</emphasis>
</para>

<para>
Когда вы используете соответствующий сценарий запуска, приведенный выше и
модуль загружен, то сценарий /opt/otrs/scripts/apache2-perl-startup.pl может
использоваться для загрузки perl-модулей в память только один раз, что
существенно экономит время загрузки и повышает производительность системы в
целом.
</para>
</section>

<section id="database-configuration">
<title>Настройка базы данных</title>

<section id="installation-of-database-with-the-web-installer">
<title>Самый простой способ - использование веб-инсталлятора (работает только с
<application>MySQL</application>)</title>

<para>
Если в качестве базы данных используется <application>MySQL</application>,
то можно воспользоваться веб-инсталлятором OTRS: <ulink
url="http://localhost/otrs/installer.pl">
<citetitle>http://localhost/otrs/installer.pl</citetitle> </ulink> .</para>

<para>
Когда запустится веб-инсталлятор, выполните, пожалуйста, следующие шаги для
установки системы:
</para>

<para>
1. Проверьте информацию о OTRS-офисах и нажмите кнопку Далее (см. ниже Рис
3.1 ).
</para>

<para>
<screenshot>
<screeninfo>installer.pl - экран приветствия</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer1.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.1. Экран приветствия.</emphasis>
</para>

<para>
2. Прочитайте соглашения лицензии GNU Affero General Public License
(см. ниже Рисунок 3.2)  и примите их, нажав на соответствующую кнопку внизу
страницы.
</para>

<para>
<screenshot>
<screeninfo>installer.pl screen - Лицензионное соглашение (1/4)</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer2.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.2. GNU Affero General Public License.</emphasis>
</para>

<para>
3. Введите имя пользователя и пароль администратора, DNS-имя компьютера на
котором находится OTRS и тип используемой СУБД. После этого, проверьте
настройки (см. ниже  Рисунок 3.3 ).
</para>

<para>
<screenshot>
<screeninfo>installer.pl - Первоначальная настройка базы данных (2/4)</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer3.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.3. Первоначальная настройка базы данных.</emphasis>
</para>

<para>
Если проверка прошла успешно, вы будете уведомлены. Чтобы продолжить,
нажмите кнопку OK (см. ниже Рисунок 3.4).
</para>

<para>
<screenshot>
<screeninfo>installer.pl - Первоначальная настройка базы данных (2/4) уведомление об
успешной проверке</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer4.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.4. Уведомление об успешной проверке.</emphasis>
</para>

<para>
4. Создайте нового пользователя базы данных, выберите имя базы данных и
нажмите кнопку 'Далее' (см. ниже Рисунок 3.5).
</para>

<warning>
<para>
Использовать пароли по умолчанию, - не очень хорошая идея. Измените
пожалуйста пароль по умолчанию для базы данных OTRS!
</para>
</warning>

<para>
<screenshot>
<screeninfo>installer.pl - Создание базы данных (2/4) все настройки</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer5.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.5. Настройки базы данных.</emphasis>
</para>

<para>
Если база данных и пользователь базы данных были успешно созданы, вы
получите уведомление, как это показанно на Рисунке 3.6. Нажмите кнопку
'Далее' для перехода к следующему этапу установки.
</para>

<para>
<screenshot>
<screeninfo>installer.pl - Создание базы данных (2/4) установка завершена успешно</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer6.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.6. Уведомление о успешной установке базы
данных.</emphasis>
</para>

<para>
5. Укажите все необходимые настройки системы и нажмите кнопку 'Дальше'
(см. ниже Рисунок 3.7 ).
</para>

<para>
<screenshot>
<screeninfo>installer.pl - Настройкси системы (3/4)</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer7.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.7. Настройки системы.</emphasis>
</para>

<para>
6. Если хотите, можно указать необходимые данные для настройки входящей и
выходящей почты, можете пропустить этот шаг, нажав кнопку в нижней части
экрана (см. Рисунок 3.8 ниже).
</para>

<para>
<screenshot>
<screeninfo>installer.pl - Настройка электронной почты (3/4)</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer8.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.8. Настройка электронной почты.</emphasis>
</para>

<para>
7. Чтобы новые конфигурационные параметры вступили в силу, перезапустите
OTRS, как это показано в Сценарии 3.13.
</para>

<para>
<screen>
linux:~ # rcotrs restart-force
Shutting down OTRS
 Disable /opt/otrs/bin/otrs.PostMaster.pl ... done.
no crontab for otrs
 Shutting down cronjobs ... failed!
Shutting down OTRS (completely)
 Shutting down Apache ... done.
 Shutting down MySQL ... done.
                                                                     done
Starting OTRS (completely)
 Starting Apache ... done.
 Starting MySQL ... done.
Starting OTRS
 Checking Apache ... done.
 Checking MySQL ... done.
 Checking database connect... (It looks Ok!).
 Enable /opt/otrs/bin/otrs.PostMaster.pl ... done.
 Checking otrs spool dir...  done.
 Creating cronjobs (source /opt/otrs/var/cron/*) ... done.

  -->> http://linux.example.com/otrs/index.pl &lt;&lt;--
                                                                     done
                                                                     done
linux:~ #
</screen>
</para>

<para>
<emphasis>Сценарий 3.13. Перезапуск службы OTRS.</emphasis>
</para>

<para>
Поздравляем! Установка OTRS завершена и можно начинать работу с системой
(см. ниже Рисунок 3.9). Для входа в веб-интерфейс OTRS, откройте веб-браузер
и наберите в адресной строке <ulink url="http://localhost/otrs/index.pl">
<citetitle>http://localhost/otrs/index.pl</citetitle> </ulink>. Чтобы войти
в систему OTRS с правами администратора, используйте логин 'root@localhost'
и пароль 'root'. Затем вы можете настроить систему в соответствии с вашими
требованиями.
</para>

<warning>
<para>
Постарайтесь как можно быстрее изменить пароль для аккаунта
'root@localhost'.
</para>
</warning>

<para>
<screenshot>
<screeninfo>installer.pl - Завершено (4/4)</screeninfo> <graphic srccredit="installer.pl -
screenshot" scale="40" fileref="screenshots/installer9.png"></graphic></screenshot>
</para>

<para>
<emphasis>Рисунок 3.9. Заключительные шаги для установки OTRS.</emphasis>
</para>

</section>

<section id="manual-installation-of-database">
<title>Установка базы данных OTRS вручную.</title>

<para>
Если вы не можете воспользоваться веб-инсталлятором для установки базы
данных OTRS, то ее нужно установить вручную. Сценарий с SQL-инструкциями для
создания и настройки базы данных находится в директории
<filename>scripts/database</filename> домашенего каталога пользователя
'otrs' (см. ниже Сценарий 3.14).
</para>

<para>
<screen>
linux:~# cd /opt/otrs/scripts/database/
linux:/opt/otrs/scripts/database# ls
otrs-initial_insert.db2.sql         otrs-schema.mysql.sql
otrs-schema.oracle.sql
otrs-initial_insert.mssql.sql       otrs-schema-post.db2.sql
otrs-initial_insert.mysql.sql       otrs-schema.postgresql.sql
otrs-initial_insert.oracle.sql
otrs-initial_insert.postgresql.sql  otrs-schema-post.mssql.sql
otrs-initial_insert.xml             otrs-schema-post.mysql.sql
otrs-schema.db2.sql                 otrs-schema-post.oracle.sql
 otrs-schema-post.postgresql.sql
otrs-schema.mssql.sql               otrs-schema.xml
linux:/opt/otrs/scripts/database#
</screen>
</para>

<para>
<emphasis>Сценарий 3.14. Файлы, необходимые для создания и настройки базы
данных.</emphasis>
</para>

<para>
При установке базы данных, для различных СУБД существует свой, определенный
порядок обработки .sql-файлов.
</para>

<para>
<orderedlist numeration="arabic">
<title>Создание базы данных OTRS вручную, шаг за шагом</title>
<listitem>
<para>
Создание базы данных: Используя интерфейс базы данных или свой любимый
менеджер баз даных, создайте базу данных, которую планируете использовать
для OTRS.
</para>
</listitem>
<listitem>
<para>
Создание таблиц: Используя файлы otrs-schema.DatabaseType.sql (например
<filename>otrs-schema.oracle.sql</filename>,
<filename>otrs-schema.postgresql.sql</filename>) можно создать таблицы в
базе данных для OTRS.
</para>
</listitem>
<listitem>
<para>
Установка исходных данных системы: Чтобы OTRS работал должным образом,
необходимо установить некоторые исходные системные данные (например
различные состояния заявок, типы заявок и уведомлений). В зависимости от
типа выбраной вами базы данных используйте один из следующих файлов
<filename>otrs-initial_insert.mysql.sql</filename>,
<filename>otrs-initial_insert.db2.sql</filename>,
<filename>otrs-initial_insert.oracle.sql</filename>,
<filename>otrs-initial_insert.postgresql.sql</filename> или
<filename>otrs-initial_insert.mssql.sql </filename>.
</para>
</listitem>
<listitem>
<para>
Создание связей между таблицами: Последний шаг - создание связей между
различными таблицами базы данных OTRS Для этого используйте файл
otrs-schema-post.DatabaseType.sql (например
<filename>otrs-schema-oracle.post.sql</filename>,
<filename>otrs-schema-post.postgresql.sql</filename>).
</para>
</listitem>
</orderedlist>
</para>

<para>
После завершения установки базы данных необходимо проверить и установить
соответствующие права доступа для базы данных OTRS. Сделать это необходимо
так, чтобы только один пользователь имел соответствующие права
доступа. Настройка прав доступа отличается в зависимости от выбраного вами
сервера базы данных и должна производится с помощью графического интерфейса
базы данных или с помощью программы клиента.
</para>

<para>
Если база данных и права доступа настроены правильно, то на следующем этапе
ее нужно подключить к OTRS. Откройте файл
<filename>Kernel/Config.pm</filename>, находящийся в домашнем каталоге
пользователя 'otrs' и измените параметры в соответствии с вашими
требованиями так, как это показанно в Сценарии 3.15.
</para>

<para>
<programlisting>

    # DatabaseHost
    # (The database host.)
    $Self->{'DatabaseHost'} = 'localhost';

    # Database
    # (The database name.)
    $Self->{Database} = 'otrs';

    # DatabaseUser
    # (The database user.)
    $Self->{DatabaseUser} = 'otrs';

    # DatabasePw
    # (The password of database user.)
    $Self->{DatabasePw} = 'some-pass';

</programlisting>
</para>

<para>
<emphasis>Сценарий 3.15. "Подгоняемые" параметры</emphasis>
</para>

</section>

</section>

<section id="cronjobs">
<title>Настрой планировщика задач (cron jobs) для OTRS</title>

<para>
Для правильной работы системы OTRS необходим планировщик задач (cron
jobs). Планировщик задач (cron jobs) должен запускаться с теми же правами,
что и модули OTRS. Именно по этому cron jobs должен быть внесен в
crontab-файл пользователя 'otrs'.
</para>

<para>
Все сценарии с cron jobs находятся в директории
<filename>var/cron</filename> домашнего каталога пользователя 'otrs'
(см. ниже Сценарий 3.16 ).
</para>

<para>
<screen>
linux:~# cd /opt/otrs/var/cron
linux:/opt/otrs/var/cron# ls
aaa_base.dist                generic_agent.dist       rebuild_ticket_index.dist
cache.dist                   pending_jobs.dist        session.dist
fetchmail.dist               postmaster.dist          unlock.dist
generic_agent-database.dist  postmaster_mailbox.dist
linux:/opt/otrs/var/cron#
</screen>
</para>

<para>
<emphasis>Сценарий 3.16. Файлы, необходимые для создания заданий
планировщика задач (cron jobs).</emphasis>
</para>

<para>
Эти сценарии имеют расширение '.dist'. Их нужно скопироваь в соответствующие
файлы без расширения. Если вы работаете в оболочке bash, то можете
воспользоваться командой из Сценария 3.17.
</para>

<para>
<screen>
linux:/opt/otrs/var/cron# for foo in *.dist; do cp $foo `basename $foo .dist`; done
linux:/opt/otrs/var/cron# ls
aaa_base                generic_agent-database.dist  rebuild_ticket_index
aaa_base.dist           generic_agent.dist           rebuild_ticket_index.dist
cache                   pending_jobs                 session
cache.dist              pending_jobs.dist            session.dist
fetchmail               postmaster                   unlock
fetchmail.dist          postmaster.dist              unlock.dist
generic_agent           postmaster_mailbox
generic_agent-database  postmaster_mailbox.dist
linux:/opt/otrs/var/cron#
</screen>
</para>

<para>
<emphasis> Сценарий 3.17. Копирование и переименование всех файлов,
необходимых для создания заданий планировщика задач (cron jobs).</emphasis>
</para>

<para>
В Таблице 3-2 приводятся различные задания cron jobs.
</para>

<para>
<table id="table-of-cronjobs-for-otrs">
<title>Описание некоторых сценариев планировщика задач cron job.</title>
  <tgroup cols="2">
    <thead>
      <row>
        <entry>
          Сценарий
        </entry>
        <entry>
          Назначение
        </entry>
      </row>
    </thead>
    <tbody>
      <row>
        <entry>
          aaa_base
        </entry>
        <entry>
          Определяет основные настройки для crontab пользователя 'otrs'.
        </entry>
      </row>
      <row>
        <entry>
          cache
        </entry>
        <entry>
          Удаляет из диска устаревшие ("просроченные") кэш-записи. Очищает
кэш-погрузчик для CSS и JavaScript файлов.
        </entry>
      </row>
      <row>
        <entry>
          fetchmail
        </entry>
        <entry>
          Этот сценарий может быть использован в том случае, если новые емейлы будут
поступать в систему обработки заявок через fetchmail.
        </entry>
      </row>
      <row>
        <entry>
          generic_agent
        </entry>
        <entry>
          Выполняет задания из GenericAgent, которые не сохраняются в базе данных, а в
собственных конфиг-файлах.
        </entry>
      </row>
      <row>
        <entry>
          generic_agent-database
        </entry>
        <entry>
          Выполняет задания из GenericAgent, которые хранятся в базе данных.
        </entry>
      </row>
      <row>
        <entry>
          pending_jobs
        </entry>
        <entry>
          Проверяет систему на наличие заявок, ожидающих решения, закрывает их или
отсылает напоминание, если это необходимо.
        </entry>
      </row>
      <row>
        <entry>
          postmaster
        </entry>
        <entry>
          Проверяет очередь сообщений системы обработки заявок, и доставляет те
сообщения, которые находятся в этой очереди.
        </entry>
      </row>
      <row>
        <entry>
          postmaster_mailbox
        </entry>
        <entry>
          Получает почту с POP3-счетов, которые были указаны в админке, в разделе
"Учетные записи PostMaster".
        </entry>
      </row>
      <row>
        <entry>
          rebuild_ticket_index
        </entry>
        <entry>
          Восстанавливает индекс заявки, что значительно повышает скорость просмотра
заявок в разделе QueueView.
        </entry>
      </row>
      <row>
        <entry>
          session
        </entry>
        <entry>
          Удаляет старые и больше не используемые ID-сессий (session IDs).
        </entry>
      </row>
      <row>
        <entry>
          unlock
        </entry>
        <entry>
          Открывает заявки, которые были ранее заблокированы в системе.
        </entry>
      </row>
    </tbody>
  </tgroup>
</table>
</para>

<para>
Чтобы настроить все задания cron jobs используйте скрипт
<filename>bin/Cron.sh</filename>, который находится в домашнем каталоге
пользователя 'otrs'. При запуске, скрипту нужно передать один из трех
параметров, указывающий на выполняемое действие: создание, удаление,
переустановка заданий. Допустимы следующие параметры:
</para>

<para>
<cmdsynopsis>
<command>Cron.sh</command> <arg choice='req'>
<replaceable>start</replaceable> </arg> <arg choice='req'>
<replaceable>stop</replaceable> </arg> <arg choice='req'>
<replaceable>restart</replaceable> </arg> <arg choice='opt'>
<replaceable>OTRS user</replaceable> </arg></cmdsynopsis>
</para>

<para>
Посокольку задания планировщика cron jobs должны быть установлены в
crontab-файле пользователя 'otrs', то нужно залогинится как пользователь
'otrs'. Если вы вошли в систему как суперпользователь (с правами
администратора) и хотите изменить пользователя - используйте команду
<command>su otrs</command>. Для установки заданий cron jobs выполните
команды приведенные ниже, в Сценарии 3.18.
</para>

<warning>
<para>
Обратите внимание, что при использовании файла <filename>Cron.sh</filename>
другие задания, установленные в crontab-файле для пользователя 'otrs' будут
перезаписаны или удалены. Внесите все необходимые изменения в файл
<filename>Cron.sh</filename>, чтобы сохранить другие crontab-задания.
</para>
</warning>

<para>
<screen>
linux:/opt/otrs/var/cron# cd /opt/otrs/bin/
linux:/opt/otrs/bin# su otrs
linux:~/bin$ ./Cron.sh start
/opt/otrs/bin
Cron.sh - start/stop OTRS cronjobs
Copyright (C) 2001-2009 OTRS AG, http://otrs.org/
(using /opt/otrs) done
linux:~/bin$ exit
exit
linux:/opt/otrs/bin#
</screen>
</para>

<para>
<emphasis>Сценарий 3.18. Установка cron jobs.</emphasis>
</para>

<para>
Команда <command>crontab -l -u otrs</command>, которую можно запускать с
правами администратора, отображает содержание crontab-файла пользователя
'otrs', так что можно легко проверить правильность расположения всех записей
(см. ниже Сценарий 3.19).
</para>

<para>
<screen>
linux:/opt/otrs/bin# crontab -l -u otrs
# --
# cron/aaa_base - base crontab package
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# Who gets the cron emails?
MAILTO="root@localhost"

# --
# cron/cache - delete expired cache
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# delete expired cache weekly (Sunday mornings)
20 0 * * 0  $HOME/bin/otrs.CacheDelete.pl --expired >> /dev/null
30 0 * * 0  $HOME/bin/otrs.LoaderCache.pl -o delete >> /dev/null

# --
# cron/fetchmail - fetchmail cron of the OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# fetch every 5 minutes emails via fetchmail
#*/5 * * * * /usr/bin/fetchmail -a &gt;&gt; /dev/null

# --
# cron/generic_agent - otrs.GenericAgent.pl cron of the OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# start generic agent every 20 minutes
*/20 * * * * $HOME/bin/GenericAgent.pl &gt;&gt; /dev/null
# example to execute GenericAgent.pl on 23:00 with
# Kernel::Config::GenericAgentMove job file
#0 23 * * * $HOME/bin/otrs.GenericAgent.pl -c "Kernel::Config::GenericAgentMove" &gt;&gt; /dev/null
# --
# cron/generic_agent - GenericAgent.pl cron of the OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# start generic agent every 10 minutes
*/10 * * * * $HOME/bin/otrs.GenericAgent.pl -c db &gt;&gt; /dev/null
# --
# cron/pending_jobs - pending_jobs cron of the OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# check every 120 min the pending jobs
45 */2 * * * $HOME/bin/otrs.PendingJobs.pl &gt;&gt; /dev/null
# --
# cron/postmaster - postmaster cron of the OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# check daily the spool directory of OTRS
#10 0 * * * * test -e /etc/init.d/otrs &amp; /etc/init.d/otrs cleanup &gt;&gt; /dev/null; test -e /etc/rc.d/init.d/otrs &amp;&amp; /etc/rc.d/init.d/otrs cleanup &gt;&gt; /dev/null
10 0 * * * $HOME/bin/otrs.CleanUp.pl &gt;&gt; /dev/null
# --
# cron/postmaster_mailbox - postmaster_mailbox cron of the OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# fetch emails every 10 minutes
*/10 * * * * $HOME/bin/otrs.PostMasterMailbox.pl &gt;&gt; /dev/null
# --
# cron/rebuild_ticket_index - rebuild ticket index for OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# just every day
01 01 * * * $HOME/bin/otrs.RebuildTicketIndex.pl &gt;&gt; /dev/null

# --
# cron/session - delete old session ids of the OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# delete every 120 minutes old/idle session ids
55 */2 * * * $HOME/bin/otrs.DeleteSessionIDs.pl --expired &gt;&gt; /dev/null

# --
# cron/unlock - unlock old locked ticket of the OTRS
# Copyright (C) 2001-2011 OTRS AG, http://otrs.org/
# --
# This software comes with ABSOLUTELY NO WARRANTY.
# --
# unlock every hour old locked tickets
35 * * * * $HOME/bin/otrs.UnlockTickets.pl --timeout &gt;&gt; /dev/null

linux:/opt/otrs/bin#
</screen>
</para>

<para>
<emphasis>Сценарий 3.19. Файл Crontab.</emphasis>
</para>

</section>

</section>

<section id="upgrading">
<title>Обновление OTRS-фреймворка</title>
<para>
Эти инструкции предназначены для тех, кто обновляет OTRS
<emphasis>2.4</emphasis> до версии <emphasis>3.0</emphasis>, их можно
применять при обновлении системы из RPM так и в случае использования
исходных кодов (тарболов).
</para>
<para>
Если вы используете более старую версию OTRS, то сначала выполните
обновление до версии 2.4
(1.1-&gt;1.2-&gt;1.3-&gt;2.0-&gt;2.1-&gt;2.2-&gt;2.3-&gt;2.4-&gt;3.0 ...).
</para>
<para>Если вы хотите сделать "patch level upgrade", который является обновлением
OTRS, например, с версии 3.0.3 до 3.0.4, то можете пропустить шаги 8, 9, 10,
and 13 - 16.
</para>

  <orderedlist>
      <listitem>
        <para>
            Остановите все соответствующие службы.
        </para>
        <para>
            в т.ч. (зависящие от использующихся услуг): <screen>
shell&gt; /etc/init.d/cron stop
shell&gt; /etc/init.d/postfix stop
shell&gt; /etc/init.d/apache stop
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
            Сделайте резервные копии всех данных из $OTRS_HOME (по умолчанию
OTRS_HOME=/opt/otrs):
            <itemizedlist>
                <listitem><para><filename>Kernel/Config.pm</filename></para></listitem>
                <listitem><para><filename>Kernel/Config/GenericAgent.pm</filename></para></listitem>
                <listitem><para><filename>Kernel/Config/Files/ZZZAuto.pm</filename></para></listitem>
                <listitem><para><filename>var/*</filename></para></listitem>
            </itemizedlist>
        </para>
      </listitem>
      <listitem>
        <para>
            Резервное копирование базы данных.
        </para>
      </listitem>
      <listitem>
        <para>
            Если есть возможность, сначала попробуйте произвести установку на отдельном
тестовом компьютере.
        </para>
      </listitem>
      <listitem>
        <para>
            Установка нового релиза (из tar-архива или с помощью RPM-пакетов).
        </para>
         <itemizedlist>
          <listitem>
            <para>
                С помощью тарбола (tarball):
            </para>
            <para>
                <screen>
shell&gt; cd /opt
shell&gt; tar -xzf otrs-x.x.x.tar.gz
shell&gt; ln -s otrs-x.x.x otrs
                </screen>
            </para>
            <para>
                Восстановите старые конфигурационные файлы.
                <itemizedlist>
                    <listitem><para><filename>Kernel/Config.pm</filename></para></listitem>
                    <listitem><para><filename>Kernel/Config/GenericAgent.pm</filename></para></listitem>
                    <listitem><para><filename>Kernel/Config/Files/ZZZAuto.pm</filename></para></listitem>
                </itemizedlist>
            </para>
          </listitem>
          <listitem>
            <para>
                С помощью RPM-пакетов: <screen>
shell&gt; rpm -Uvh otrs-x.x.x.-01.rpm
                </screen>
            </para>
            <para>
                В этом случае обновление из RPM автоматически восстанавливает старые
конфигурационные файлы.
            </para>
          </listitem>
         </itemizedlist>
      </listitem>
      <listitem>
        <para>
            Собственные темы
        </para>
        <para>
            Примечание: Темы OTRS 2.4 и OTRS 3.0 являются НЕ совместимыми, так что не
используйте старые темы. Темы расположены в каталоге
$OTRS_HOME/Kernel/Output/HTML/*/*.dtl (default: OTRS_HOME=/opt/otrs).
        </para>
      </listitem>
      <listitem>
        <para>
            Установка прав доступа к файлам.
        </para>
        <para>
            В случае использования тарбола (tarball), выполните <screen>
shell> cd /opt/otrs/
shell> bin/otrs.SetPermissions.pl
            </screen> с правами, необходимыми для установки системы.
        </para>
      </listitem>
      <listitem>
        <para>
            Примените изменения к базе данных (часть 1/2):
        </para>
        <para>
            <screen>
shell&gt; cd /opt/otrs/

# MySQL:
shell&gt; cat scripts/DBUpdate-to-3.0.mysql.sql | mysql -p -f -u root otrs
# PostgreSQL:
shell&gt; cat scripts/DBUpdate-to-3.0.postgresql.sql | psql otrs
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
            Запустите сценарий перемещения (как пользователь 'otrs', а НЕ root):
        </para>
        <para>
            Сценарий перемещения (миграции) нужно запускать для перемещения некоторых
данных из старой базы данных в новую. Пожалуйста, запустите: <screen>
shell&gt; scripts/DBUpdate-to-3.0.pl
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
            Примените изменения к базе данных (часть 2/2):
        </para>
        <para>
            <screen>
# MySQL:
shell&gt; cat scripts/DBUpdate-to-3.0-post.mysql.sql | mysql -p -f -u root otrs
# PostgreSQL:
shell&gt; cat scripts/DBUpdate-to-3.0-post.postgresql.sql | psql otrs
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
Обновите конфигурацию системы и удалите все данные из кэша. Пожалуйста,
введите:
        </para>
        <para>
            <screen>
shell&gt; bin/otrs.RebuildConfig.pl
shell&gt; bin/otrs.DeleteCache.pl
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
            Перезапустите сервисы.
        </para>
        <para>
            в т.ч. (зависящие от использующихся услуг): <screen>
shell&gt; /etc/init.d/cron start
shell&gt; /etc/init.d/postfix start
shell&gt; /etc/init.d/apache start
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
    Проверьте возможные проблемы с кодировкой:
        </para>
        <para>
            В OTRS 3.0, кодировка по умолчанию была изменена с "iso-8859-1" на "utf-8".
        </para>
        <para>
            Это каснется вас только в том случае, если вы не указали кодировку в файле
Kernel/Config.pm (все установки, которые были произведены с помощью
веб-инсталлятора имеют пользовательские настройки) или, если вы не изменили
кодировку по умолчанию в AdminSysConfig.
        </para>
        <para>
            Если у вас возникли проблемы с новой кодировкой, добавьте эту строку в файл
Kernel/Config.pm: <screen>
    $Self->{'DefaultCharset'} = 'iso-8859-1';
            </screen>
        </para>
        <para>
            В общем, "UTF-8" это только рекомендованный набор символов для работы OTRS,
и переключение на "ISO-8859-1" будет работать также хорошо.
        </para>
        <para>
            Примечание: Мы настоятельно рекомендуем обновить все установленные на
сегодня системы OTRS, в которых нету поддержки UTF-8 до версии 3.0. Все
другие кодировки считаются устаревшыми.
        </para>
        <para>
            OTRS 3.1 будет испольвать исключительно UTF-8 в качестве внутренней
кодировки.
        </para>
      </listitem>
      <listitem>
        <para>Check for Custom Frontend Module Registrations</para>
        <para>
            Начиная с OTRS 3.0, модули приложений могут иметь свои собственные CSS-стили
и/или JavaScript-сценарии. Это является частью так называемого интерфейсного
модуля регистрации новых модулей в SysConfig. Такой подход может вызвать
проблемы при обновлении, так ка, по умолчанию, конфигурационные настройки
интерфейсного модуля, которые были изменены локально не будут получать
обновлений.
        </para>
        <para>
            Чтобы убедиться что ничего не пострадало, пожалуйста, проверьте файл
<filename>Kernel/Config/Files/ZZZAuto.pm</filename>. Особое внимание
обратите на такие записи, как например: <screen>
    $Self->{'Frontend::Module'}->{'AgentStats'} = { ... };
            </screen>
        </para>
        <para>
            Эти настройки должны быть сброшены в значения по умолчанию в Admin ->
SysConfig (в данном случае: 'Frontend::Module###AgentStats') с помощью
небольшой кнопки "Сбросить", которая находится рядом с флажком
"Активизировать".Таким образом, настройки будут сброшены в соответствии с
новыми, специфическими настройками модуля и больше не будут появляться в
<filename>Kernel/Config/Files/ZZZAuto.pm</filename>. Если необходимо, в
будущем, вы сможете настроить эти параметры заново.
        </para>
        <para>
            Такая же процедура должна быть выполнена для настройки
"Frontend::ToolBarModule###1-Ticket::TicketSearchFulltext", поскольку он
также использует CSS-стили, конкретного модуля. Вы можете смело пропустить
этот шаг, если в вашей системе эти настройки не активированы.
        </para>
      </listitem>
      <listitem>
        <para>Check for customized PreferencesGroups entries</para>
        <para>
            With OTRS 3.0, there were a few corrections in PreferencesGroups
configuration entries.  Notably, the keys 'Activ' and 'Colum' were changed
to 'Active' and 'Column', respectively.  You only need to take action if you
have customized such settings on your system, otherwise they will be updated
automatically.
        </para>
        <para>
            To check if you are affected, please look at the file
<filename>Kernel/Config/Files/ZZZAuto.pm</filename> and look for entries
like: <screen>
    $Self->{'CustomerPreferencesGroups'}->{'RefreshTime'} =  {
      'Activ' => '0',
      'Colum' => 'Frontend',
      'Data' => {
        '' => 'off',
        '10' => '10 minutes',
        '15' => '15 minutes',
        '2' => ' 2 minutes',
        '5' => ' 5 minutes',
        '7' => ' 7 minutes'
      },
      'Desc' => 'Select your QueueView refresh time.',
      'Label' => 'QueueView refresh time',
      'Module' => 'Kernel::Output::HTML::PreferencesGeneric',
      'PrefKey' => 'UserRefreshTime',
      'Prio' => '4000'
    };
            </screen> This needs to be changed as
follows: <screen>
    $Self->{'CustomerPreferencesGroups'}->{'RefreshTime'} =  {
      'Active' => '0',
      'Column' => 'Frontend',
      'Data' => {
        '' => 'off',
        '10' => '10 minutes',
        '15' => '15 minutes',
        '2' => ' 2 minutes',
        '5' => ' 5 minutes',
        '7' => ' 7 minutes'
      },
      'Desc' => 'Select your QueueView refresh time.',
      'Label' => 'QueueView refresh time',
      'Module' => 'Kernel::Output::HTML::PreferencesGeneric',
      'PrefKey' => 'UserRefreshTime',
      'Prio' => '4000'
    };
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
            Переименование пользовательских полей в базе данных
        </para>
        <para>
            Поле 'Приветствие', встроенное в клиентскую базу данных было переименовано в
более подходящее 'Заголовок'. Если для клиентов используется встроенная база
данных, и вы изменили конфигурацию, например, добавили новые поля в таблицу
клиентов или включили поддержку для Компаний Клиентов, необходимо изменить
правила преобразования (mapping) в <filename>Kernel/Config.pm</filename>:
        </para>
        <para>
             Измените эту строку с: <screen>
     [ 'UserSalutation', 'Salutation', 'salutation', 1, 0, 'var', '', 0 ],
            </screen> на: <screen>
     [ 'UserTitle',      'Title',      'title',      1, 0, 'var', '', 0 ],
            </screen>
        </para>
        <para>
            Пожалуйста, обратите винмание на то, что это также может повлиять на любые
приветствия или шаблоны, в которых используется строка
<literal>&lt;OTRS_*_UserSalutation&gt;</literal>. Если вы использовали эту
строку И используете встроенную таблицу клиентов, пожалуйста, замените ее на
<literal>&lt;OTRS_CURRENT_UserTitle&gt;</literal>.
        </para>
      </listitem>
      <listitem>
        <para>
            Дополнительно:  Помечайте Заявки как Прочитанные
        </para>
        <para>
            В OTRS 3.0 появилась новая возможность: Новые заявки и новые статьи, которые
Агент еще не читал, выделены как 'непрочитанные'. Все заявки, которые были
созданны перед обновлением OTRS до версии 3.0 будут помечены как
'непрочитанные'. Если вам не нравиться такой подход, воспользуйтесь
специальным скриптом, чтобы пометить все заявки и статьи как прочитанные для
всех агентов, которые имеют права на чтение этих заявок. Обратите внимание,
что для работы этого сценария может потребоваться некоторое время!
<screen>
shell> bin/otrs.MarkTicketAsSeen.pl
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>Молодцы!</para>
      </listitem>
  </orderedlist>
</section>

<section id="upgrade-windows-installer">
<title>Обновление с помощью Windows Installer</title>
<para>
В настоящее время нету механизма автоматического обновления копии OTRS,
которая была установлена с использованием инсталлятора Windows (Windows
Installer). В основном, процесс обновления состоит из таких шагов:
архивирование базы данных и всей файловой системы, деинсталяция OTRS,
установка новой версии, восстановление базы данных и запуск процедуры
обновления (если она необходима).
</para>

<para>Обновление подробно описано по ссылке <ulink
url="http://faq.otrs.org/otrs/public.pl?Action=PublicFAQ;ItemID=351">FAQ#
4200351</ulink>, также по ссылке <ulink
url="http://www.youtube.com/watch?v=sf0R-reMTWc">YouTube video</ulink> можно
найти достаточно информативное видео.
</para>
</section>

</chapter>