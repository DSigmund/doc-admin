<?xml version='1.0' encoding='ISO-8859-1'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<!-- $Id: performance-tuning.xml,v 1.7 2009-01-21 13:18:30 ub Exp $ -->

<chapter id="performance-tuning">
<title>Performance Tuning</title>

<abstract>
<para>
An exhaustive list of various techniques you might want to use to get the
most performance possible out of your OTRS system: configuration, coding,
memory use and more.
</para>
</abstract>

<sect1 id="performance-tuning-otrs">
<title>OTRS</title>
<para>
There are several options to improve the performance of OTRS.
</para>

<sect2 id="performance-tuning-otrs-index">
<title>TicketIndexModule</title>
<para>
You have two backend modules for the ticket index.
</para>
<para>
Kernel/Config.pm
<programlisting>
[...]
    $Self->{TicketIndexModule} = 'Kernel::System::Ticket::IndexAccelerator::RuntimeDB';
[...]
</programlisting>
</para>

<para>
<itemizedlist mark='opencircle'>

<listitem>
<para>
Kernel::System::Ticket::IndexAccelerator::RuntimeDB (default), generate
each queue view on the fly from the ticket table. You will not have performance
trouble until you have about 60,000 tickets (with 6,000 open tickets) in your system.
</para>
</listitem>

<listitem>
<para>
Kernel::System::Ticket::IndexAccelerator::StaticDB, the most powerful module, it
should be used when you have above 80,000 tickets (more than 6,000 open tickets) - use an extra ticket_index table,
works like a view. Use bin/RebuildTicketIndex.pl for an initial index build.
</para>
</listitem>

</itemizedlist>

</para>
</sect2>


<sect2 id="performance-tuning-otrs-storage">
<title>TicketStorageModule</title>
<para>
You have two backend modules for the ticket/article storage.
</para>
<para>
Kernel/Config.pm
<programlisting>
[...]
    $Self->{Ticket::StorageModule} = 'Kernel::System::Ticket::ArticleStorageDB';
[...]
</programlisting>
</para>

<para>
<itemizedlist mark='opencircle'>

<listitem>
<para>
Kernel::System::Ticket::ArticleStorageDB (default), store attachments etc.
in the database. Note: Don't use it for larger set ups.
</para>
<para>
Pro: If your webserver user isn't the otrs user, use this module to avoid
file permission problems.
</para>
<para>
Contra: It's not really advisable to store attachments in your database. Take care
that your database is able to store large objects. E.g. MySQL (config)
"set-variable = max_allowed_packet=8M" to store 8 MB objects (default is 2M).
</para>
</listitem>

<listitem>
<para>
Kernel::System::Ticket::ArticleStorageFS, store attachments etc. in the local
file system. Note: Use it for larger set ups.
</para>
<para>
Pro: Faster!
</para>
<para>
Contra: Your webserver user should be the otrs user (file system permissions!).
</para>
</listitem>

</itemizedlist>

</para>

<para>
Note: If you use OTRS 1.2 or higher, you can switch from one to the other
backend on the fly.
</para>

</sect2>

</sect1>


<sect1 id="performance-tuning-database">
<title>Database</title>
<para>
This depends on the database you are using. If you're having trouble, read the
documentation for your database or ask your database admin.
</para>

<sect2 id="performance-tuning-database-mysql">
<title>MySQL</title>
<para>
If you use MySQL table type MyISAM (which is the default) and have deleted a
large part of a table or if you have made many changes to a table with
variable-length rows (tables that have VARCHAR, BLOB or TEXT columns)
you need to defragment the datafile (tables) with the "optimize" command.
</para>
<para>
You should try it if mysqld needs a lot of your CPU time. Optimize table
ticket, ticket_history and article.
<programlisting>
shell$ mysql -u user -p datbase
mysql$ optimize table ticket;
mysql$ optimize table ticket_history;
mysql$ optimize table article;
</programlisting>
</para>
</sect2>

<sect2 id="performance-tuning-database-postgresql">
<title>PostgreSQL</title>
<para>
PostgreSQL is best tuned by modifying the postgresql.conf file in your
PostgreSQL data directory. For advice on how to do this, see these
articles:
<ulink url="http://www.varlena.com/varlena/GeneralBits/Tidbits/perf.html">
<citetitle>http://www.varlena.com/varlena/GeneralBits/Tidbits/perf.html</citetitle>
</ulink>
<ulink url="http://www.varlena.com/varlena/GeneralBits/Tidbits/annotated_conf_e.html">
<citetitle>http://www.varlena.com/varlena/GeneralBits/Tidbits/annotated_conf_e.html</citetitle>
</ulink>
If performance is still not satisfactory, we suggest that you join the
PostgreSQL Performance mailing list and ask questions there. The folks on
the PostgreSQL list are very friendly and can probably help
<ulink url="http://www.postgresql.org/lists.html">http://www.postgresql.org/lists.html</ulink>.
</para>
</sect2>

</sect1>


<sect1 id="performance-tuning-webserver">
<title>Webserver</title>
<para>
Of course you should use mod_perl 2.0 (
<ulink url="http://perl.apache.org/">
<citetitle>http://perl.apache.org/</citetitle>
</ulink>).
It's much faster (~ * 100) than pure cgi. But needs more RAM. So your
httpd with mod_perl will be about 16 MB (~10MB shared).
</para>

<sect2 id="performance-tuning-webserver-db">
<title>Preestablish datababase connections</title>
<para>
You can have the datababase connections pe-established on process startup (httpd).
This saves time (see README.webserver).
</para>
</sect2>

<sect2 id="performance-tuning-webserver-startup">
<title>Preloaded modules - startup.pl</title>
<para>
Use the scripts/apache-perl-startup.pl (mod_perl 1.0) or scripts/apache2-perl-startup.pl (mod_perl 2.0) startup script for preloaded/precompiled Perl
modules on your mod_perl webserver to be faster and smaller (see README.webserver).
</para>
</sect2>
<sect2 id="performance-tuning-webserver-reload">
<title>Reload Perl modules when updated on disk</title>
<para>
Per default Apache::Reload (mod_perl 2.0) is used
in scripts/apache2-httpd.include.conf. Disable it and you will get 8% more
speed. But remember to restart the webserver if you change the Kernel/Config.pm
or any other modules!
Important; now you can't use the OTRS-Packet-Manager via web interface, you need to use
CMD - bin/opm.pl.
</para>
</sect2>

<sect2 id="performance-tuning-webserver-strategy">
<title>Choosing the Right Strategy</title>
<para>
If you have a really large installation (over 1,000 new tickets a day and over 40
Agents) it is a good idea to read "Choosing the Right Strategy"
(<ulink url="http://perl.apache.org/docs/1.0/guide/strategy.html">
<citetitle>http://perl.apache.org/docs/1.0/guide/strategy.html</citetitle>
</ulink>).
</para>
</sect2>

<sect2 id="performance-tuning-webserver-gzip">
<title>mod_gzip/mod_deflate</title>
<para>
If your bandwidth is a little bit small, use mod_gzip for Apache1
(<ulink url="http://www.schroepl.net/projekte/mod_gzip/">
<citetitle>http://www.schroepl.net/projekte/mod_gzip/</citetitle>
</ulink>) or mod_deflate for Apache2 (default module in Apache2).
If you have an html page with 45k, mod_gzip/mod_deflate compresses it. The page will be
about 7k.
</para>
</sect2>

<sect2 id="performance-tuning-webserver-dos">
<title>mod_dosevasive</title>
<para>
If you want to block http DoS (Denial of Service) attacks, use mod_dosevasive.
(<ulink url="http://www.nuclearelephant.com/projects/dosevasive/">
<citetitle>http://www.nuclearelephant.com/projects/dosevasive/</citetitle>
</ulink>).
</para>
</sect2>

</sect1>

</chapter>
