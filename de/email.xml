<?xml version='1.0' encoding='ISO-8859-1'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">
<!-- $Id: email.xml,v 1.3 2005-09-08 13:53:56 cs Exp $ -->

<chapter id="email">
<title>Email versenden/empfangen</title>

<sect1 id="email-sending">
<title>Emails versenden</title>

<sect2 id="email-sending-sendmail">
<title>Via Sendmail (Standard)</title>

<para>OTRS ist in der Lage, Emails via Sendmail (z.B.
 <ulink url="http://www.sendmail.org/">Sendmail</ulink>,
 <ulink url="http://www.postfix.org/">Postfix</ulink>,
 <ulink url="http://www.qmail.org">Qmail</ulink> or
 <ulink url="http://www.exim.org">Exim</ulink>) zu versenden. Die
    Standard-Konfiguration sollte gleich ohne Probleme funktionieren.
</para>

<para>Es gibt die Konfiguration über das Admin-Interface-SysConfig (Framework::Core::Sendmail) oder in "Kernel/Config.pm" vorgenommen werden:</para>

<para>
<programlisting>
    # SendmailModule
    # (Where is sendmail located and some options.
    # See "man sendmail" for details.)
    $Self-&gt;{"SendmailModule"} = "Kernel::System::Email::Sendmail";
    $Self-&gt;{"SendmailModule::CMD"} = "/usr/sbin/sendmail -t -i -f ";
</programlisting>
</para>
</sect2>

<sect2 id="email-sending-smtp">
<title>Via SMTP relay/smarthost</title>

<para>OTRS ist in der Lage, Emails via SMTP (
<ulink url="http://www.ietf.org/rfc/rfc821.txt">Simple Mail Transfer Protocol / RFC 821</ulink>) zu versenden. Hauptsächlich auf Nicht-Unix-Plattformen (z.B. Win32) benutzt.</para>

<para>Die Konfiguration kann über das Admin-Interface-SysConfig (Framework::Core::Sendmail) oder in "Kernel/Config.pm" vorgenommen werden:</para>

<para>
<programlisting>
    # SendmailModule
    $Self-&gt;{"SendmailModule"} = "Kernel::System::Email::SMTP";
    $Self-&gt;{"SendmailModule::Host"} = "mail.example.com";
    $Self-&gt;{"SendmailModule::AuthUser"} = "";
    $Self-&gt;{"SendmailModule::AuthPassword"} = "";
</programlisting>
</para>
</sect2>

</sect1>

<sect1 id="email-receiving">
<title>Emails empfangen</title>

<sect2 id="email-receiving-pop3">
<title>Via POP3-Konten - der einfache Weg (PostMasterPOP3.pl)</title>
<para>OTRS ist in der Lage, Emails von POP3-Konten zu empfangen.</para>

<para>Konfigurieren Sie Ihre POP3-Konten über das Admin-Interface (POP3 Account).
<screenshot><screeninfo>Email-Adresse hinzufügen</screeninfo><graphic
fileref="screenshots/admin-postmasterpop3.png" scale="40" srccredit="add POP3 account - screenshot"></graphic></screenshot></para>

<para>Starten Sie "bin/PostMasterPOP3.pl" und alle Emails werden in Ihr OTRS geholt.</para>

<para>Ausserdem gibt es einen Beispiel-Cronjob (var/cron/postmaster_pop3.dist), der "bin/PostMasterPOP3.pl" alle 10 Minuten ausführt (s. auch Kapitel Cronjobs).</para>

</sect2>


<sect2 id="email-receiving-cmd">
<title>Via Kommandozeilen-Programm und z.B. procmail (PostMaster.pl)</title>

<para>OTRS ist in der Lage, Emails über ein Kommandozeilen-Programm (bin/PostMaster.pl) zu empfangen.</para>

<para>Das bedeutet, dass Emails im OTRS angezeigt werden, wenn der MDA (mail delivery agent, z.B. procmail) die Emails nach "bin/PostMaster.pl" durchleitet.</para>

<para>Um "bin/PostMaster.pl" auf der Kommandozeile (ohne MDA) zu testen, benutzen Sie folgendes:</para>

<para>
<programlisting>
shell:~ # cat /opt/otrs/doc/test-email-1.box | /opt/otrs/bin/PostMaster.pl
shell:~ #
</programlisting>
Wenn die Email in der Queue-Ansicht angezeigt wird, sind Ihre Einstellungen in Ordnung.</para>

<para>Procmail ist ein sehr bekannter Email-Filter in der Linux-Umgebung.
 Es wird wahrscheinlich auf Ihrem System installiert sein. Falls nicht,
 schauen Sie auf der <ulink url="http://www.procmail.org/"><citetitle>procmail
 Homepage</citetitle></ulink>.
</para>

<para>Um procmail zu konfigurieren (benötigt einen für procmail
 konfigurierten MDA (z.B. sendmail, postfix, exim oder qmail)), benutzen
 Sie ".procmailrc" und ändern Sie das folgende:
</para>

<para>
<programlisting>
SYS_HOME=$HOME
PATH=/bin:/usr/bin:/usr/local/bin
# --
# Pipe all email into the PostMaster process.
# --
:0 :
| $SYS_HOME/bin/PostMaster.pl
</programlisting>

Alle an den lokalen OTRS Benutzer gesendeten Emails werden an
"bin/PostMaster.pl" durchgeleitet und dann in der Queue-Ansicht angezeigt.
</para>

<sect3>
<title>Emails via POP3 oder IMAP und fetchmail für PostMaster.pl empfangen</title>

<para>Um Emails von Ihrem Mailserver via POP3 oder IMAP für den
 OTRS-Rechner/lokalen OTRS-Benutzer und procmail abzuholen, benutzen Sie
 <ulink url="http://www.tuxedo.org/~esr/fetchmail/">fetchmail</ulink>.
 Hinweis: Voraussetzung ist eine funktionierende SMTP-Konfiguration auf
 dem OTRS-Rechner.
<example>
<title>.fetchmailrc</title>
<programlisting>
#poll (mailserver) protocol POP3 user (user) password (password) is (localuser)
poll mail.example.com protocol POP3 user joe password mama is otrs
</programlisting>
</example>
</para>

<para>Vergessen Sie nicht, .fetchmailrc auf 710 zu setzen ("chmod 710 .fetchmailrc")!</para>

<para>Wenn "fetchmail -a" ausgeführt wird (ggf. via cron), werden alle Emails auf das lokale OTRS-Konto weitergeleitet.</para>
</sect3>
</sect2>

<sect2 id="email-receiving-filter">
<title>Filterung/Verteilung über PostMaster Module (für komplexere Verteilungsszenarien)</title>

<para>Falls Sie die "bin/PostMaster.pl" oder "bin/PostMasterPOP3.pl" Methoden benutzen, können Sie die X-OTRS-Header mit den PostMaster-Filtermodulen modifizieren.</para>


<para>Zum Beispiel können Sie die Priorität oder die Queue eines Tickets mit den PostMaster-Filtermodulen einstellen.</para>

<para>Es gibt verschiedene Standard-Filtermodule.</para>

<para>Hinweis: Der Jobname (z.B.  $Self-&#62;{"PostMaster::PreFilterModule"}-&#62;{"Jobname"}) muss eindeutig sein!</para>

<para>Kernel::System::PostMaster::Filter::Match ist ein Standard-Modul, um
 einige Email-Header (z.B. From, To, Subject, ...) zu prüfen und dann den
 neuen Email-Header zu setzen (z.B. X-OTRS-Ignore: yes oder X-OTRS-Queue:
 spam).</para>

<para>
<screen>
Kernel/Config.pm
[...]
    # Job Name: 1-Match
    # (block/ignore all spam email with From: noreply@)
    $Self-&gt;{"PostMaster::PreFilterModule"}-&gt;{"1-Match"} = {
        Module =&gt; "Kernel::System::PostMaster::Filter::Match",
        Match =&gt; {
            From =&gt; "noreply@",
        },
        Set =&gt; {
            "X-OTRS-Ignore" =&gt; "yes",
        },
    };
    # Job Name: 2-Match
    # (sort emails with From: sales@example.com and Subject: **ORDER**
    # into queue "Order")
    $Self-&gt;{"PostMaster::PreFilterModule"}-&gt;{"2-Match"} = {
        Module =&gt; "Kernel::System::PostMaster::Filter::Match",
        Match =&gt; {
            To =&gt; "sales@example.com",
            Subject =&gt; "**ORDER**",
        },
        Set =&gt; {
            "X-OTRS-Queue" =&gt; "Order",
        },
    };
[...]
</screen>
</para>

<para>Kernel::System::PostMaster::Filter::CMD ist ein Standard-Modul, um
 die Emails an ein externes Kommando zu leiten und falls das Ergebnis aus
 STDOUT true ist, den neuen Email-Header zu setzen (z.B. X-OTRS-Ignore: yes
 oder X-OTRS-Queue: spam).</para>

<para>
<screen>
Kernel/Config.pm
[...]
    # Job Name: 5-SpamAssassin
    # (SpamAssassin example setup, ignore spam emails)
    $Self-&gt;{"PostMaster::PreFilterModule"}-&gt;{"5-SpamAssassin"} = {
        Module =&gt; "Kernel::System::PostMaster::Filter::CMD",
        CMD =&gt; "/usr/bin/spamassassin | grep -i &#34;X-Spam-Status: yes&#34;",
        Set =&gt; {
            "X-OTRS-Ignore" =&gt; "yes",
        },
    };
[...]
</screen>
</para>

<para>Natürlich ist es auch möglich, eigene PostMaster-Filtermodule zu entwicklen.</para>

<para>Ausserdem gibt es eine Liste aller möglichen X-OTRS-Header in doc/X-OTRS-Headers.txt.</para>

</sect2>

</sect1>

</chapter>
