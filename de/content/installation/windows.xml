<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">

<section id="installation-on-windows">
    <title>OTRS auf Windows</title>

    <para>
        Um OTRS auf Windows zu betreiben empfehlen wir die <ulink
url="http://otrs.github.io/doc/manual/appliance/stable/en/html/index.html">OTRS
Appliance</ulink> zu verwenden.
    </para>

    <section id="migrating-otrs-from-windows-into-appliance">
        <title>Wie eine existierende Windows-Installation in die Appliance migriert wird</title>
        <section id="introduction-and-preparation">
            <title>Einführung und Vorbereitung</title>
            <para>
                Diese Anleitung wird Ihnen dabei helfen wenn Sie ein OTRS-System unter
Windows betreiben und zur Appliance wechseln wollen. Alle notwendigen
Schritte zur Migration von OTRS unter Windows zur Appliance werden hier
beschrieben.
            </para>
            <para>
                First of all we need to update our OTRS to the latest version of 3.3.x to
prevent migration problems.
            </para>
            <para>
                Nach dem Upgrade Ihres OTRS-Systems benötigen Sie eine separate Installation
einer OTRS Appliance mit der gleichen OTRS-Version wie auf Ihrem
Windows-System. Wenn Sie z.B. OTRS 3.3.x verwenden, dann benötigen Sie eine
OTRS Appliance 3.3.x. Eine detaillierte Anleitung finden Sie hier:
            </para>
            <para>
                <ulink url="http://otrs.github.io/doc/manual/appliance/3.3/en/html/">
<citetitle>Appliance-Installationsanleitung</citetitle> </ulink>
            </para>
            <para>
                Eine Liste aller verfügbaren Appliance Downloads kann unter folgender
Adresse gefunden werden:
            </para>
            <para>
                <ulink url="http://ftp.otrs.org/pub/otrs/">
<citetitle>http://ftp.otrs.org/pub/otrs/</citetitle> </ulink>
            </para>
            <para>
                In unserem Beispiel benötigen wir die Appliance für OTRS 3.3.10:
            </para>
            <para>
                <ulink url="http://ftp.otrs.org/pub/otrs/otrs-3.3.10-appliance-1.0.10.iso">
<citetitle>http://ftp.otrs.org/pub/otrs/otrs-3.3.10-appliance-1.0.10.iso</citetitle>
</ulink>
            </para>
            <para>
                Wir haben nun 2 Systeme und müssen die Datenbank vom ersten System auf das
zweite System verschieben.
            </para>
        </section>
        <section id="get-otrsclonedb-script-to-clone-databases">
            <title>Downloaden Sie das OTRSCloneDB-Skript um Datenbanken zu klonen</title>
            <para>
                Bitte gehen Sie zum Admin-Menü in Ihrem Windows-System und installieren Sie
die neueste Version des OTRSCloneDB-Paketes in Ihr OTRS.
            </para>
            <para>
                Sie können das OTRSCloneDB-Paket direkt aus dem Paket-Manager
installieren. Wählen Sie "OTRS Extensions" aus der Dropdown-Liste auf der
linken Seite aus und klicken Sie auf den Button "Verzeichnis
aktualisieren". Das Paket OTRSCloneDB wird dann in einer Liste angezeigt,
klicken Sie dann auf "Installieren".
            </para>
            <para>
                You could also download the package manually from the OTRS FTP server and
install the package manually as described below.  <ulink
url="http://ftp.otrs.org/pub/otrs/packages/">
<citetitle>http://ftp.otrs.org/pub/otrs/packages/</citetitle> </ulink>
            </para>
            <para>
                Downloaden Sie das Paket mit der höchsten Versionsnummer:
            </para>
            <para>
                <screen>
OTRSCloneDB-1.0.10.opm
                </screen>
            </para>
            <para>
                <screenshot>
<screeninfo>Download des OTRSCloneDB-Skript - Screenshot</screeninfo> <graphic srccredit="Download
OTRSCloneDB - screenshot" scale="80"
fileref="screenshots/win-download-otrsclonedb.png"></graphic></screenshot>
            </para>
            <para>
                und installieren Sie es auf Ihrer Windows-basierten Installation:
            </para>
            <para>
                <screenshot>
<screeninfo>Installieren des OTRSCloneDB-Skripts - Screenshot</screeninfo> <graphic srccredit="Install
OTRSCloneDB - screenshot" scale="80"
fileref="screenshots/win-install-otrsclonedb.png"></graphic></screenshot>
            </para>
            <para>
                It is also no problem if you have installed some feature addons or custom
developments on your OTRS.  You just need to take care that all of your
installed packages are also compatible with unix based systems.  For
packages provided by OTRS this is the case.
            </para>
        </section>
        <section id="enable-remote-access-for-appliance-database">
            <title>Aktivieren Sie den Remote-Zugang für die PostgreSQL-Datenbank in Ihrer
Appliance</title>
            <para>
                Das OTSRCloneDB-Script kopiert die Datenbank via Netzwerk, deshalb müssen
wir den Netzwerk-Zugriff auf der Ziel-Datenbank einrichten.
            </para>
            <para>
                Stellen Sie eine SSH-Verbindung zu Ihrer Appliance her. Sie können dies mit
einem kostenlosen Tool wie z.B. "PuTTY" erledigen (suchen Sie im Internet
nach "putty ssh"). Die IP-Adresse der Appliance wird im Startbildschirm der
Appliance angezeigt. Nach der Verbindung per SSH wechseln Sie in das
postgresql Verzeichnis:
            </para>
            <para>
                <screen>
shell> cd /etc/postgresql/8.4/main
shell> vi postgresql.conf
                </screen>
            </para>
            <para>
                Fügen Sie folgende Zeile am Ende der Datei hinzu:
            </para>
            <para>
                <screen>
listen_addresses = '*'
                </screen>
            </para>
            <para>
                Speichern Sie die Datei.
            </para>
            <para>
                <screen>
Shell> vi pg_hba.conf
                </screen>
            </para>
            <para>
                Fügen Sie folgende Zeile am Ende der Datei hinzu:
            </para>
            <para>
                <screen>
host all all  0.0.0.0/0 md5
                </screen>
            </para>
            <para>
                Speichern Sie die Datei.
            </para>
            <para>
                Starten Sie Ihren postgresql-Server neu
            </para>
            <para>
                <screen>
Shell> service postgresql restart
                </screen>
            </para>
        </section>
        <section id="backup-appliance-manangement-package">
            <title>Backup des Paketes OTRSApplianceManagement</title>
            <para>
                In der Appliance ist immer das Paket OTRSApplianceManagement instaliert, das
zusätzliche Administrationsfunktionen zur Verfügung stellt. Bevor wir die
Datenbank der Appliance löschen, müssen wir dieses Paket herunterladen.
            </para>
            <para>
                Rufen Sie den Paket-Manager in Ihrer Appliance auf.
            </para>
            <para>
                Wählen Sie das Paket OTRSApplianceManagement und downloaden Sie das Paket.
            </para>
            <para>
                <screenshot>
<screeninfo>Download des OTRSApplianceManagement-Pakets - Screenshot</screeninfo> <graphic srccredit="Download
OTRSApplianceManagement package - screenshot" scale="80"
fileref="screenshots/win-download-appliance-package.png"></graphic></screenshot>
            </para>
            <para>
                Dieses Paket wird erneut benötigt nachdem die Migration abgeschlossen ist.
            </para>
        </section>
        <section id="stop-all-otrs-services">
            <title>OTRS-Dienste stoppen</title>
            <para>
                Stoppen Sie alle laufenden Services der Appliance:
            </para>
            <para>
                <screen>
shell> service cron stop
shell> service apache2 stop
shell> su - otrs
shell> cd /opt/otrs/
shell> bin/Cron.sh stop
shell> bin/otrs.Scheduler.pl -a stop
shell> exit
                </screen>
            </para>
        </section>
        <section>
            <title>Droppen Sie die bereits existierende Datenbank Ihrer Appliance, um für die
geklonte Datenbank eine leere Datenbank zu besitzen.</title>
            <para>
                Das OTRSCloneDB-Skript wird keine Daten in der existierenden
Appliance-Datenbank entfernen, somit müssen Sie das manuell erledigen:
            </para>
            <para>
                Wechseln Sie zu dem PostgreSQL-Benutzer: <screen>
Shell> su - postgres
                </screen>
            </para>
            <para>
                Droppen Sie die existierende OTRS-Datenbank: <screen>
Shell> dropdb otrs
                </screen>
            </para>
            <para>
                Erstellen Sie eine neue OTRS-Datenbank für den OTRS-User: <screen>
Shell> createdb --owner=otrs --encoding=utf8 otrs
                </screen>
            </para>
            <para>
                Wechseln Sie zurück zum Root-User: <screen>
Shell> exit
                </screen>
            </para>
            <para>
                <screenshot>
<screeninfo>Neu-Erstellung der OTRS-Appliance-Datenbank - Screenshot</screeninfo> <graphic srccredit="Recreate OTRS
appliance database - screenshot" scale="80"
fileref="screenshots/win-empty-db-appliance.png"></graphic></screenshot>
            </para>
        </section>
        <section id="get-password-of-otrs-database">
            <title>Geben Sie das PostgreSQL-Passwort Ihrer Datenbank ein</title>
            <para>
                Wechsel Sie in das OTRS-Verzeichnis Ihrer Appliance:
            </para>
            <para>
                <screen>
Shell> cd /opt/otrs
                </screen>
            </para>
            <para>
                und schauen Sie sich die Konfigurationsdatei Ihres Appliance-Systems an:
            </para>
            <para>
                <screen>
Shell> less Kernel/Config.pm
                </screen>
            </para>
            <para>
                Sie finden das Datenbank-Passwort, wenn Sie ein wenig scrollen:
            </para>
            <para>
                <screenshot>
<screeninfo>Das Appliance-Datenbank-Passwort erhalten - Screenshot</screeninfo> <graphic srccredit="Get appliance
database password - screenshot" scale="80"
fileref="screenshots/win-gather-db-data-1.png"></graphic></screenshot>
            </para>
            <para>
                In unserem Beispiel:
            </para>
            <para>
                <screen>
I88cm34A1B6xrl3
                </screen> Notieren Sie sich das Passwort.
            </para>
        </section>
        <section id="clone-database-to-remote-appliance">
            <title>Klonen Sie die Datenbank in die neue Appliance</title>
            <para>
                Wechseln Sie zu Ihrem Windows-System und öffnen das
Sysconfig-Admin-Menü. Wählen Sie die Gruppe "OTRSCloneDB" und die
Untergruppe "Configuration":
            </para>
            <para>
                <screenshot>
<screeninfo>Konfiguration der OTRSCloneDB Sysconfig 1 - screenshot</screeninfo> <graphic srccredit="Configurate
OTRSCloneDB SysConfig 1 - screenshot" scale="80"
fileref="screenshots/win_configurate_otrsclonedb_sysconfig-1.png"></graphic></screenshot>
            </para>
            <para>
                Sie müssen in der SysConfig die Option OTRSCloneDB::TargetSettings mit den
folgenden Werten konfigurieren:
            </para>
            <para>
                <screen>
TargetDatabaseHost => 192.168.137.20 (Here you need to enter the ip address of your appliance)
TargetDatabase => otrs
TargetDatabaseUser => otrs
TargetDatabasePw => I88cm34A1B6xrl3 (Here you need to set the password of your appliance)
TargetDatabaseType => postgresql
                </screen>
            </para>
            <para>
                <screenshot>
<screeninfo>Konfiguration der OTRSCloneDB Sysconfig 2 - screenshot</screeninfo> <graphic srccredit="Configurate
OTRSCloneDB SysConfig 2 - screenshot" scale="80"
fileref="screenshots/win-configurate-otrsclonedb-sysconfig-2.png"></graphic></screenshot>
            </para>
            <para>
                Um das Skript OTRSCloneDB auszuführen, müssen Sie die in der Kommandozeile
des Windows-basierten Systems in das OTRS-Verzeichnis wechseln:
            </para>
            <para>
                <screen>
Shell> cd "C:\otrs"
                </screen>
            </para>
            <para>
                Wenn Sie StrawberryPerl benutzen, müssen Sie eventuell Perl für Ihre Shell
aktivieren:
            </para>
            <para>
                <screen>
Shell> StrawberryPerl\portableshell.bat
                </screen>
            </para>
            <para>
                <screenshot>
<screeninfo>Ausführen des OTRSCloneDB-Skript 1 - screenshot</screeninfo> <graphic srccredit="Run OTRSCloneDB
script 1 - screenshot" scale="80"
fileref="screenshots/win-run-otrsclonedb-1.png"></graphic></screenshot>
            </para>
            <para>
                Das OTRSCloneDB-Skript befindet sich im bin-Verzeichnis des
OTRS-Verzeichnisses.
            </para>
            <para>
                <screen>
Shell> cd "OTRS\bin"
                </screen>
            </para>
            <para>
                Führen Sie das OTRSCloneDB-Skript aus:
            </para>
            <para>
                <screen>
Shell> perl otrs.OTRSCloneDB.pl
                </screen>
            </para>
            <para>
                Nun sollten Sie einige Informationen und Parameter des Skriptes sehen.
            </para>
            <para>
                <screenshot>
<screeninfo>Run OTRSCloneDB script 2 - screenshot</screeninfo> <graphic srccredit="Run OTRSCloneDB
script 2 - screenshot" scale="80"
fileref="screenshots/win-run-otrsclonedb-2.png"></graphic></screenshot>
            </para>
            <para>
                Anmerkung... Fehler die während einer Ausführung ohne Parameter auftreten,
können mit falschen Login-Daten für die Datenbank oder mit Problemen in der
Datenbankverbindung zusammenhängen.
            </para>
            <para>
                Wenn keine Fehler aufgetreten sind, überprüfen Sie über der Trockenlauf
erfolgreich war:
            </para>
            <para>
                <screen>
Shell> perl otrs.OTRSCloneDB.pl -n
                </screen>
            </para>
            <para>
                <screenshot>
<screeninfo>Run OTRSCloneDB script 3 - screenshot</screeninfo> <graphic srccredit="Run OTRSCloneDB
script 3 - screenshot" scale="80"
fileref="screenshots/win-run-otrsclonedb-3.png"></graphic></screenshot>
            </para>
            <para>
                Starten Sie das Klonen der Datenbank:
            </para>
            <para>
                <screen>
Shell> perl otrs.OTRSCloneDB.pl -r
                </screen>
            </para>
            <para>
                Ein Beispiel für eine erfolgreiche Migration sieht wie folgt aus:
            </para>
            <para>
                <screen>
Generating DDL for OTRS.
Generating DDL for package OTRSCloneDB.
Creating structures in target database (phase 1/2)
...
...
Creating structures in target database (phase 2/2)
...
done.
                </screen>
            </para>
        </section>
        <section id="copy-otrs-base-files-to-remote-appliance">
            <title>Kopieren Sie die folgenden Dateien von Ihrer Windows-basierten Installation
in die Appliance</title>
            <para>
                Sie müssen einige Dateien von Ihrem Windows-System auf die Appliance
kopieren. Sie können dies z.B. mit einem kostenlosen Tool wie "WinSCP"
erledigen (suchen Sie im Internet nach "WinSCP"). Kopieren Sie die folgenden
Dateien von Ihrem Windows-System:
            </para>
            <para>
                <screen>
C:/otrs/OTRS/Kernel/Config/GenericAgent.pm
C:/otrs/OTRS/Kernel/Config/Files/ZZZAuto.pm
C:/otrs/OTRS/var/article/*
C:/otrs/OTRS/var/log/TicketCounter.log
                </screen>
            </para>
            <para>
                zu Ihrer Appliance:
            </para>
            <para>
                <screen>
/opt/otrs/Kernel/Config/GenericAgent.pm
/opt/otrs/Kernel/Config/Files/ZZZAuto.pm
/opt/otrs/var/article/*
/opt/otrs/var/log/TicketCounter.log
                </screen> Öffnen Sie die Datei
/opt/otrs/Kernel/Config/Files/ZZZAuto.pm in der Appliance und ersetzen Sie
alle Pfade wie "C:/otrs/OTRS/" mit "/opt/otrs/"!
            </para>
            <para>
                Falls Sie manuelle Änderungen in der Datei Kernel/Config.pm gemacht haben,
dann müssen Sie diese manuell in die Appliance übernehmen. Kopieren Sie die
Änderungen jedoch nicht 1:1, da es auf der Appliance nun andere
Datenbankeinstellungen und andere Datei-Pfade gibt als unter Windows!
            </para>
        </section>
        <section id="reinstall-packages-install-otrs-appliance-management">
            <title>Installieren Sie alle Pakete neu und installieren Sie das
OTRSApplianceManagement</title>
            <para>
                Re-Installieren Sie alle Pakete um angepassten Dateien zurück zu erhalten
und installieren Sie erneut das Paket OTRSApplianceManagement, das Sie zuvor
herunter geladen haben.
            </para>
            <para>
                Kopieren Sie das Backup des OTRSApplianceManagement-1.0.4.opm in das
root-Verzeichnis des OTRS-Systems nach /opt/otrs.
            </para>
            <para>
                <screen>
shell> bin/otrs.SetPermissions.pl --otrs-user=otrs --otrs-group=otrs --web-user=www-data --web-group=www-data /opt/otrs
shell> su - otrs
shell> cd /opt/otrs
shell> perl bin/otrs.DeleteCache.pl
shell> perl bin/otrs.LoaderCache.pl -o delete
shell> perl bin/otrs.PackageManager.pl -a reinstall-all
shell> perl bin/otrs.PackageManager.pl -a install -p OTRSApplianceManagement-1.0.4.opm
shell> exit
                </screen>
            </para>
            <para>
                Setzen Sie alle Berechtigungen in Ihrem OTRS-System erneut:
            </para>
            <para>
                <screen>
shell> bin/otrs.SetPermissions.pl --otrs-user=otrs --otrs-group=otrs --web-user=www-data --web-group=www-data /opt/otrs
                </screen>
            </para>
        </section>
        <section id="disable-remote-access-for-appliance-database">
            <title>Deaktivieren Sie den Remote-Zugang für die PostgreSQL-Datenbank in Ihrer
Appliance</title>
            <para>
                Setzen Sie alle Einstellung für den PostgreSQL-Remote-Zugang, die sie vorher
getätigt haben,zurück.
            </para>
            <para>
                Wechseln Sie in das PostgreSQL-Verzeichnis:
            </para>
            <para>
                <screen>
shell> cd /etc/postgresql/8.4/main
shell> vi postgresql.conf
                </screen>
            </para>
            <para>
                Entfernen Sie die folgenden Zeilen am Ende der Datei:
            </para>
            <para>
                <screen>
listen_addresses = '*'
                </screen>
            </para>
            <para>
                Speichern Sie die Datei.
            </para>
            <para>
                <screen>
Shell> vi pg_hba.conf
                </screen>
            </para>
            <para>
                Entfernen Sie die folgenden Zeilen am Ende der Datei:
            </para>
            <para>
                <screen>
host all all  0.0.0.0/0 md5
                </screen>
            </para>
            <para>
                Speichern Sie die Datei.
            </para>
            <para>
                Starten Sie Ihren postgresql-Server neu
            </para>
            <para>
                <screen>
Shell> service postgresql restart
                </screen>
            </para>
        </section>
        <section id="start-all-otrs-services">
            <title>OTRS-Dienste starten</title>
            <para>
                Starten Sie alle Services der Appliance:
            </para>
            <para>
                <screen>
Shell> service cron start
Shell> service apache2 start
Shell> su - otrs
Shell> cd /opt/otrs/
Shell> bin/Cron.sh start
Shell> bin/otrs.Scheduler.pl -a start
                </screen>
            </para>
            <para>
                Nun sollten Sie sich via Web-Interface in das OTRS auf Ihrer Appliance
einloggen können.
            </para>
        </section>
    </section>
</section>
