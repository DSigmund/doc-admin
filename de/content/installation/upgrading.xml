<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
  "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">

<section id="upgrading">
<title>Upgrade des OTRS Frameworks</title>
<para>
    Diese Hinweise sind für Leute gedacht, die von OTRS <emphasis>3.2</emphasis>
auf <emphasis>3.3</emphasis> upgraden, und gilt für RPM-basierte und
manuelle Upgrades (tarball).
</para>

<note>
    <para>
        Please note that OTRS 3.3 requires at least perl version 5.10.0. Make sure
before you plan your upgrade that your server runs this version. You can
check the version with the command <command>perl -v</command> on the command
line.The only known Linux distribution that uses perl 5.8 and is still
supported by its vendor is Red Hat Enterprise Linux (RHEL) 5 and its
community supported derivative CentOS 5.  If you're on any of these
platforms and you plan to upgrade to OTRS 3.3 you should also plan migrating
your operating system to a version with a supported perl, such as RHEL 6 or
CentOS 6.
    </para>
</note>

<para>
    Wenn Sie eine ältere Version von OTRS einsetzen, müssen sie zuerst dem
Upgrade-Pfad zur 3.1 folgen
(1.1->1.2->1.3->2.0->2.1->2.2->2.3->2.4->3.0->3.1->3.2->3.3 ...)! Sie müssen
ein vollständiges Upgrade auf jede Zwischen-Version inklusive der
Datenbankänderungen und der Perlskripte durchführen.
</para>
<para>
    Bitte beachten Sie, falls Sie von OTRS 2.2 oder früher upgraden, müssen Sie
einen extra Schritt durchführen; bitte lesen Sie dazu <ulink
url="http://bugs.otrs.org/show_bug.cgi?id=6798">http://bugs.otrs.org/show_bug.cgi?id=6798</ulink>.
</para>
<para>
    Innerhalb einer Minor-Version können Sie einzelne Patch-Level-Versionen
überspringen, falls Sie upgraden wollen. Beispielsweise können Sie direkt
von OTRS 3.3.1 auf OTRS 3.3.4 upgraden. Wenn Sie so ein
"Patch-Level-Upgrade" durchführen, können Sie Schritt 9 und 13-16-
überspringen.
</para>
<para>
    Bitte beachten Sie wenn Sie ein Upgrade von OTRS 3.3.6 oder früher
durchführen, müssen Sie einen neuen Cronjob aktivieren, der den
Scheduler-Prozess kontrolliert. Bitte kopieren Sie dazu die Datei
<filename>/opt/otrs/var/cron/scheduler_watchdog.dist</filename> nach
<filename>/opt/otrs/var/cron/scheduler_watchdog</filename> und aktualisieren
Sie anschließend ihre Crontabs mit <filename>/opt/otrs/bin/Cron.sh
start</filename> (als "otrs" user, nicht root).
</para>

  <orderedlist>
      <listitem>
        <para>
            Stoppen Sie alle relevanten Dienste.
        </para>
        <para>
            z. B. (hängt von eingesetzten Diensten ab): <screen>
shell&gt; /etc/init.d/cron stop
shell&gt; /etc/init.d/postfix stop
shell&gt; /etc/init.d/apache stop
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
            Sichern Sie folgende Daten in $OTRS_HOME (Standard: OTRS_HOME=/opt/otrs):
            <itemizedlist>
                <listitem><para><filename>Kernel/Config.pm</filename></para></listitem>
                <listitem><para><filename>Kernel/Config/GenericAgent.pm</filename></para></listitem>
                <listitem><para><filename>Kernel/Config/Files/ZZZAuto.pm</filename></para></listitem>
                <listitem><para><filename>var/*</filename></para></listitem>
                <listitem><para><filename>und die Datenbank</filename></para></listitem>
            </itemizedlist>
        </para>
      </listitem>
      <listitem>
        <para>
            Bitte stellen Sie sicher das ein umfangreiches Backup vorliegt.
        </para>
      </listitem>
      <listitem>
        <para>
            Installieren eines neuen Systems (optional)
        </para>
        <para>
            Neues System aufsetzen (optional). Wenn möglich, installieren Sie zunächst
auf einer separaten Testmaschine.
        </para>
      </listitem>
      <listitem>
        <para>
            Installieren Sie das neue Release (tar oder RPM).
        </para>
         <itemizedlist>
          <listitem>
            <para>
                Mit dem Tarball:
            </para>
            <para>
                <screen>
shell&gt; cd /opt
shell&gt; mv otrs otrs-old
shell&gt; tar -xzf otrs-x.x.x.tar.gz
shell&gt; mv otrs-x.x.x otrs</screen>
            </para>
            <para>
                Wiederherstellen alter Konfiguration Dateien
                <itemizedlist>
                    <listitem><para><filename>Kernel/Config.pm</filename></para></listitem>
                    <listitem><para><filename>Kernel/Config/GenericAgent.pm</filename></para></listitem>
                    <listitem><para><filename>Kernel/Config/Files/ZZZAuto.pm</filename></para></listitem>
                </itemizedlist>
            </para>
            <para>
                Wiederherstellung TicketCounter.log
            </para>
            <para>
                Damit OTRS mit der richtigen Ticketnummer weiter arbeitet, stellen Sie die
Datei <filename>TicketCounter.log</filename> in
<filename>$OTRS_HOME/var/log/</filename> (Standard:
<filename>OTRS_HOME=/opt/otrs</filename>) wieder her. Das ist vorallem dann
wichtig, wenn Sie inkrementelle Ticketnummern verwenden.
            </para>
            <para>
                Wiederherstellung article data
            </para>
            <para>
                Wenn Sie OTRS so konfiguriert haben, dass Artikeldaten im Dateisystem
gespeichert werden, müssen Sie den Ordner <filename>article</filename> nach
<filename>$OTRS_HOME/var/</filename> (Standard:
<filename>OTRS_HOME=/opt/otrs</filename>) wiederherstellen.
            </para>
          </listitem>
          <listitem>
            <para>
                Per RPM: <screen>
shell&gt; rpm -Uvh otrs-x.x.x.-01.rpm
                </screen>
            </para>
            <para>
                In diesem Fall stellt das RPM-Update die alten Konfigurationsdateien
automatisch wieder her.
            </para>
          </listitem>
         </itemizedlist>
      </listitem>
      <listitem>
        <para>
            Eigene Themes
        </para>
        <para>
            Hinweis: Die OTRS-Themes von 3.2 sind NICHT zu 3.3 kompatibel, verwenden Sie
ihre alten Themes daher nicht weiter!
        </para>
        <para>
            Themes befinden sich in /opt/otrs/Kernel/Output/HTML/*/*.dtl (Standard:
OTRS_HOME=/opt/otrs).
        </para>
        <para>
            Bitte beachten Sie das dtl-Dateien in UTF-8 sein müssen in OTRS 3.3.
        </para>
      </listitem>
      <listitem>
        <para>
            Setzen Sie die Datei-Berechtigungen.
        </para>
        <para>
            wenn der Tarball benutzt wird, führen Sie <screen>
shell&gt; cd /opt/otrs/
shell&gt; bin/otrs.SetPermissions.pl</screen> aus, um die Berechtigungen zu setzen, die für Ihr System benötigt
werden.
        </para>
      </listitem>
      <listitem>
            <para>
                Überprüfung benötigter Perl Module
            </para>
            <para>
               Versichern Sie sich dass alle benötigten Perl-Module auf Ihrem System
installiert sind und installieren Sie alle Module die fehlen. <screen>
shell&gt; /opt/otrs/bin/otrs.CheckModules.pl</screen>
            </para>
      </listitem>
      <listitem>
        <para>
            Schema aktualisieren:
        </para>
        <para>
             Note: new tables created in the MySQL UPGRADING process will be created with
the default table storage engine set in your MySQL server.  In MySQL 5.5 the
new default type is InnoDB.  If existing tables, e.g. "users", have the
table storage engine, e.g. MyISAM, then an error will be displayed when
creating the foreign key constraints.
         </para>
         <para>
            You have two options: (1) you can change the default storage engine of MySQL
back to MyISAM so that new tables will have the same engine as the existing
tables, or (2) change the existing tables to use InnoDB as storage engine.
        </para>
        <para>
            Any problems with regards to the storage engine will be reported by the
otrs.CheckDB.pl script, so please run it to check for possible issues.
        </para>
        <para>
            <screen>
shell&gt; cd /opt/otrs/

# MySQL:
shell&gt; bin/otrs.CheckDB.pl
shell&gt; cat scripts/DBUpdate-to-3.3.mysql.sql | mysql -p -f -u root otrs

# PostgreSQL 8.2+:
shell&gt; cat scripts/DBUpdate-to-3.3.postgresql.sql | psql --set ON_ERROR_STOP=on --single-transaction otrs otrs

# PostgreSQL, older versions:
shell&gt; cat scripts/DBUpdate-to-3.3.postgresql_before_8_2.sql | psql --set ON_ERROR_STOP=on --single-transaction otrs otrs</screen>
        </para>
        <para>
            Note: If you use PostgreSQL 8.1 or earlier, you need to activate the new
legacy driver for these older versions. Do this by adding a new line to your
<filename>Kernel/Config.pm</filename> like this: <screen>
$Self->{DatabasePostgresqlBefore82} = 1;</screen>
        </para>
        <para>
            Führen Sie das Migrationsskript aus (als OTRS-Benutzer, nicht als root!):
        </para>
        <para>
            <screen>
shell&gt; scripts/DBUpdate-to-3.3.pl</screen> Do not continue the upgrading process if
this script does not work properly for you.  Otherwise data loss may occur.
        </para>
      </listitem>
      <listitem>
        <para>
Aktualisieren Sie die Konfiguration und löschen Sie die Caches. Bitte führen
Sie folgendes aus (als Benutzer 'OTRS', NICHT als 'root'):
        </para>
        <para>
            <screen>
shell&gt; bin/otrs.RebuildConfig.pl
shell&gt; bin/otrs.DeleteCache.pl
            </screen>
        </para>
      </listitem>
      <listitem>
        <para>
            Starten Sie Ihre Dienste neu.
        </para>
        <para>
            e. g. (depends on used services): <screen>
shell&gt; /etc/init.d/cron start
shell&gt; /etc/init.d/postfix start
shell&gt; /etc/init.d/apache start
            </screen> Now
you can log into your system.
        </para>
      </listitem>
      <listitem>
        <para>Installierte Pakete überprüfen</para>
        <para>
            Prüfen Sie im Paketmanager, ob alle Pakete noch als korrekt installiert
markiert sind oder eine Re-Installation oder ein Upgrade benötigen.
        </para>
        <para>
            The following packages are automatically uninstalled after the upgrade
process (if they where installed before):
        </para>
        <itemizedlist>
            <listitem><para>OTRSPostMasterFilterExtensions</para></listitem>
            <listitem><para>OTRSFreeTextFromCustomerUser</para></listitem>
            <listitem><para>OTRSExternalTicketNumberRecognition</para></listitem>
            <listitem><para>OTRSDashboardQueueOverview</para></listitem>
            <listitem><para>OTRSImportantArticles</para></listitem>
            <listitem><para>OTRSImportantArticlesITSM</para></listitem>
            <listitem><para>OTRSDashboardTicketCalendar</para></listitem>
            <listitem><para>OTRSMultiServiceSelect</para></listitem>
            <listitem><para>OTRSMultiQueueSelect</para></listitem>
            <listitem><para>OTRSDynamicFieldMultiLevelSelection</para></listitem>
            <listitem><para>OTRSEventBasedTicketActions</para></listitem>
            <listitem><para>OTRSTicketAclEditor</para></listitem>
            <listitem><para>OTRSCustomerProcessSelection</para></listitem>
            <listitem><para>OTRSACLExtensions</para></listitem>
            <listitem><para>OTRSGenericStandardTemplates</para></listitem>
            <listitem><para>OTRSExtendedDynamicDateFieldSearch</para></listitem>
            <listitem><para>OTRSDashboardTicketOverviewFilters</para></listitem>
        </itemizedlist>
      </listitem>
      <listitem>
        <para>
            Check config settings of OTRSFreeTextFromCustomerUser
        </para>
        <para>
            Note: This only applies if you used the package OTRSFreeTextFromCustomerUser
previously.
        </para>
        <para>
            If you used this module previously, you need to reconfigure it.  The module
is automatically uninstalled by the upgrading script as it is now a part of
the OTRS framework.
        </para>
        <para>
            If you want to keep using it, please enable the setting
"Ticket::EventModulePost###930-DynamicFieldFromCustomerUser" to activate
this feature and configure the mapping in the setting
"DynamicFieldFromCustomerUser::Mapping".
        </para>
       </listitem>
       <listitem>
        <para>
            Importieren Sie ihre ACLs in den neuen ACL-Editor (optional)
        </para>
        <para>
            In OTRS 3.3, there is a graphical editor for ACLs in the administration
interface. You will need to import your existing ACLs (e.g. in Config.pm or
additional files) to the editor by using bin/otrs.ImportACLsFromConfig.pl in
order to make them available in the editor. Please make sure to delete any
ACLs from Config.pm (or other files) after successfully finishing the import
procedure. Also you will need to use the deploy button in the ACL
administration frontend in order to re-deploy the imported ACLs to your
system.
        </para>
      </listitem>
      <listitem>
        <para>
            Aktualisieren der Webserver-Konfiguration
        </para>
        <para>
            Note: this applies only if you use the Apache web server, and do not use the
configuration file directly from the OTRS installation directory (e. g. with
a symlink from the Apache configuration directory).
        </para>
        <para>
            Please update the the Apache configuration file for OTRS as there have been
several changes (see
<filename>scripts/apache2-httpd.include.conf</filename>).
        </para>
      </listitem>
      <listitem>
        <para>
            Aktualisieren und Aktivieren der Cronjobs
        </para>
        <para>
            There are several OTRS default cronjobs in $OTRS_HOME/var/cron/*.dist.  They
can be activated by copying them without the ".dist" filename extension.  Do
this to make sure you get the latest versions of the cronjobs and new
cronjobs as well.  <screen><![CDATA[
shell> cd var/cron
shell> for foo in *.dist; do cp $foo `basename $foo .dist`; done
            ]]></screen>

        </para>
        <para>
            Please check the copied files and re-apply any customizations that you might
have made.
        </para>
        <para>
            To schedule these cronjobs on your system, you can use the script Cron.sh.
Make sure to execute it as the OTRS system user! <screen><![CDATA[
shell> /opt/otrs/bin/Cron.sh start
            ]]></screen>
        </para>
      </listitem>
      <listitem>
        <para>Gut gemacht!</para>
      </listitem>
  </orderedlist>
</section>
